import{r as T,j as e}from"./vendor-react-BuVtq312.js";import{b as Q,u as H,t as j,k as p,G as O,g as W,L as U,B as u,C as v,z as y,A as f,a as N,I as l}from"./index-hzFfJlKH.js";import{L as n}from"./label-DJDGx5UM.js";import{T as R}from"./textarea-CA7ezKjn.js";import{S as b,a as D,b as F,c as w,d}from"./select-BmfPitD4.js";import{N as J}from"./Navigation-DKoTJDrW.js";import{f as V,a as K}from"./vendor-date-B2OJh1lx.js";import{z as X,a2 as Y,a8 as Z,L as _}from"./vendor-icons-CPPAmKDz.js";import"./vendor-data-DopHG4T0.js";import"./vendor-radix-DQBG9U-J.js";import"./UserAvatar-DzPpP9tb.js";function me(){const{loading:P,isAuthenticated:g}=Q(),[,q]=H(),[s,i]=T.useState({clientId:"",title:"",currency:"USD",taxRate:"0",discountType:"percentage",discountValue:"0",notes:"",terms:"",issueDate:V(new Date,"yyyy-MM-dd"),validUntil:V(K(new Date,30),"yyyy-MM-dd")}),[o,C]=T.useState([{id:"1",description:"",quantity:"1",rate:"",amount:"0"}]),{data:k}=j.clients.list.useQuery(void 0,{enabled:g}),{data:A}=j.estimates.generateNumber.useQuery(void 0,{enabled:g}),{data:h}=j.products.list.useQuery(void 0,{enabled:g}),I=j.estimates.create.useMutation({onSuccess:t=>{p.success("Estimate created successfully"),q(`/estimates/${t.id}`)},onError:t=>{p.error(t.message||"Failed to create estimate")}}),r=T.useMemo(()=>{const t=o.reduce((m,L)=>m+(parseFloat(L.amount)||0),0);let a=0;s.discountType==="percentage"?a=t*(parseFloat(s.discountValue)||0)/100:a=parseFloat(s.discountValue)||0;const c=t-a,E=c*(parseFloat(s.taxRate)||0)/100,x=c+E;return{subtotal:t,discountAmount:a,taxAmount:E,total:x}},[o,s.discountType,s.discountValue,s.taxRate]),S=(t,a,c)=>{C(E=>E.map(x=>{if(x.id!==t)return x;const m={...x,[a]:c};if(a==="quantity"||a==="rate"){const L=parseFloat(m.quantity)||0,G=parseFloat(m.rate)||0;m.amount=(L*G).toFixed(2)}return m}))},B=()=>{C(t=>[...t,{id:Date.now().toString(),description:"",quantity:"1",rate:"",amount:"0"}])},M=t=>{o.length!==1&&C(a=>a.filter(c=>c.id!==t))},z=t=>{const a=h?.find(c=>c.id===parseInt(t));a&&C(c=>[...c,{id:Date.now().toString(),description:a.description||a.name,quantity:"1",rate:a.rate,amount:a.rate}])},$=()=>{if(!s.clientId){p.error("Please select a client");return}if(!A){p.error("Estimate number not generated");return}const t=o.filter(a=>a.description&&parseFloat(a.amount)>0);if(t.length===0){p.error("Please add at least one line item");return}I.mutate({clientId:parseInt(s.clientId),estimateNumber:A,title:s.title||void 0,currency:s.currency,subtotal:r.subtotal.toFixed(2),taxRate:s.taxRate,taxAmount:r.taxAmount.toFixed(2),discountType:s.discountType,discountValue:s.discountValue,discountAmount:r.discountAmount.toFixed(2),total:r.total.toFixed(2),notes:s.notes||void 0,terms:s.terms||void 0,issueDate:new Date(s.issueDate),validUntil:new Date(s.validUntil),lineItems:t.map(a=>({description:a.description,quantity:a.quantity,rate:a.rate,amount:a.amount}))})};return P?e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:201",className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:202",className:"opacity-70",children:e.jsx(O,{"data-loc":"client/src/pages/CreateEstimate.tsx:203",size:"md"})})}):g?e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:215",className:"min-h-screen bg-background",children:[e.jsx(J,{"data-loc":"client/src/pages/CreateEstimate.tsx:216"}),e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:218",className:"container mx-auto px-4 py-8",children:e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:219",className:"max-w-4xl mx-auto",children:[e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:221",className:"flex items-center gap-4 mb-8",children:[e.jsx(U,{"data-loc":"client/src/pages/CreateEstimate.tsx:222",href:"/estimates",children:e.jsxs(u,{"data-loc":"client/src/pages/CreateEstimate.tsx:223",variant:"ghost",size:"sm",children:[e.jsx(X,{"data-loc":"client/src/pages/CreateEstimate.tsx:224",className:"h-4 w-4 mr-2"}),"Back"]})}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:228",children:[e.jsx("h1",{"data-loc":"client/src/pages/CreateEstimate.tsx:229",className:"text-3xl font-bold text-foreground",children:"Create Estimate"}),e.jsxs("p",{"data-loc":"client/src/pages/CreateEstimate.tsx:232",className:"text-muted-foreground",children:["Estimate #",A||"Loading..."]})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:238",className:"space-y-6",children:[e.jsxs(v,{"data-loc":"client/src/pages/CreateEstimate.tsx:240",children:[e.jsx(y,{"data-loc":"client/src/pages/CreateEstimate.tsx:241",children:e.jsx(f,{"data-loc":"client/src/pages/CreateEstimate.tsx:242",children:"Estimate Details"})}),e.jsxs(N,{"data-loc":"client/src/pages/CreateEstimate.tsx:244",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:245",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:246",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:247",htmlFor:"client",children:"Client *"}),e.jsxs(b,{"data-loc":"client/src/pages/CreateEstimate.tsx:248",value:s.clientId,onValueChange:t=>i(a=>({...a,clientId:t})),children:[e.jsx(D,{"data-loc":"client/src/pages/CreateEstimate.tsx:254",children:e.jsx(F,{"data-loc":"client/src/pages/CreateEstimate.tsx:255",placeholder:"Select a client"})}),e.jsx(w,{"data-loc":"client/src/pages/CreateEstimate.tsx:257",children:k?.map(t=>e.jsxs(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:259",value:t.id.toString(),children:[t.name,t.companyName&&` (${t.companyName})`]},t.id))})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:271",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:272",htmlFor:"currency",children:"Currency"}),e.jsxs(b,{"data-loc":"client/src/pages/CreateEstimate.tsx:273",value:s.currency,onValueChange:t=>i(a=>({...a,currency:t})),children:[e.jsx(D,{"data-loc":"client/src/pages/CreateEstimate.tsx:279",children:e.jsx(F,{"data-loc":"client/src/pages/CreateEstimate.tsx:280"})}),e.jsxs(w,{"data-loc":"client/src/pages/CreateEstimate.tsx:282",children:[e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:283",value:"USD",children:"USD - US Dollar"}),e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:284",value:"EUR",children:"EUR - Euro"}),e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:285",value:"GBP",children:"GBP - British Pound"}),e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:286",value:"CAD",children:"CAD - Canadian Dollar"}),e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:289",value:"AUD",children:"AUD - Australian Dollar"})]})]})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:297",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:298",htmlFor:"title",children:"Title / Subject (optional)"}),e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:299",id:"title",placeholder:"e.g., Website Redesign Proposal",value:s.title,onChange:t=>i(a=>({...a,title:t.target.value}))})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:309",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:310",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:311",htmlFor:"issueDate",children:"Issue Date"}),e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:312",id:"issueDate",type:"date",value:s.issueDate,onChange:t=>i(a=>({...a,issueDate:t.target.value}))})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:325",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:326",htmlFor:"validUntil",children:"Valid Until"}),e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:327",id:"validUntil",type:"date",value:s.validUntil,onChange:t=>i(a=>({...a,validUntil:t.target.value}))})]})]})]})]}),e.jsxs(v,{"data-loc":"client/src/pages/CreateEstimate.tsx:344",children:[e.jsx(y,{"data-loc":"client/src/pages/CreateEstimate.tsx:345",children:e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:346",className:"flex items-center justify-between",children:[e.jsx(f,{"data-loc":"client/src/pages/CreateEstimate.tsx:347",children:"Line Items"}),h&&h.length>0&&e.jsxs(b,{"data-loc":"client/src/pages/CreateEstimate.tsx:349",onValueChange:z,children:[e.jsx(D,{"data-loc":"client/src/pages/CreateEstimate.tsx:350",className:"w-[200px]",children:e.jsx(F,{"data-loc":"client/src/pages/CreateEstimate.tsx:351",placeholder:"Add from products"})}),e.jsx(w,{"data-loc":"client/src/pages/CreateEstimate.tsx:353",children:h.map(t=>e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:355",value:t.id.toString(),children:t.name},t.id))})]})]})}),e.jsx(N,{"data-loc":"client/src/pages/CreateEstimate.tsx:367",children:e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:368",className:"space-y-4",children:[o.map((t,a)=>e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:370",className:"grid grid-cols-12 gap-2 items-start",children:[e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:374",className:"col-span-12 md:col-span-5",children:e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:375",placeholder:"Description",value:t.description,onChange:c=>S(t.id,"description",c.target.value)})}),e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:387",className:"col-span-4 md:col-span-2",children:e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:388",type:"number",placeholder:"Qty",value:t.quantity,onChange:c=>S(t.id,"quantity",c.target.value)})}),e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:397",className:"col-span-4 md:col-span-2",children:e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:398",type:"number",step:"0.01",placeholder:"Rate",value:t.rate,onChange:c=>S(t.id,"rate",c.target.value)})}),e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:408",className:"col-span-3 md:col-span-2",children:e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:409",readOnly:!0,value:`${s.currency} ${t.amount}`,className:"bg-muted"})}),e.jsx("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:415",className:"col-span-1",children:e.jsx(u,{"data-loc":"client/src/pages/CreateEstimate.tsx:416",variant:"ghost",size:"icon",onClick:()=>M(t.id),disabled:o.length===1,"aria-label":`Remove line item: ${t.description||"Item "+a}`,children:e.jsx(Y,{"data-loc":"client/src/pages/CreateEstimate.tsx:423",className:"h-4 w-4 text-muted-foreground","aria-hidden":"true"})})})]},t.id)),e.jsxs(u,{"data-loc":"client/src/pages/CreateEstimate.tsx:432",variant:"outline",onClick:B,className:"w-full","aria-label":"Add new line item",children:[e.jsx(Z,{"data-loc":"client/src/pages/CreateEstimate.tsx:438",className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Add Line Item"]})]})})]}),e.jsxs(v,{"data-loc":"client/src/pages/CreateEstimate.tsx:446",children:[e.jsx(y,{"data-loc":"client/src/pages/CreateEstimate.tsx:447",children:e.jsx(f,{"data-loc":"client/src/pages/CreateEstimate.tsx:448",children:"Totals"})}),e.jsx(N,{"data-loc":"client/src/pages/CreateEstimate.tsx:450",children:e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:451",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:452",className:"flex justify-between",children:[e.jsx("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:453",className:"text-muted-foreground",children:"Subtotal"}),e.jsxs("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:454",className:"font-medium",children:[s.currency," ",r.subtotal.toFixed(2)]})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:459",className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:460",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:461",children:"Discount"}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:462",className:"flex gap-2",children:[e.jsxs(b,{"data-loc":"client/src/pages/CreateEstimate.tsx:463",value:s.discountType,onValueChange:t=>i(a=>({...a,discountType:t})),children:[e.jsx(D,{"data-loc":"client/src/pages/CreateEstimate.tsx:472",className:"w-[100px]",children:e.jsx(F,{"data-loc":"client/src/pages/CreateEstimate.tsx:473"})}),e.jsxs(w,{"data-loc":"client/src/pages/CreateEstimate.tsx:475",children:[e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:476",value:"percentage",children:"%"}),e.jsx(d,{"data-loc":"client/src/pages/CreateEstimate.tsx:477",value:"fixed",children:s.currency})]})]}),e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:482",type:"number",step:"0.01",value:s.discountValue,onChange:t=>i(a=>({...a,discountValue:t.target.value}))})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:496",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:497",children:"Tax Rate (%)"}),e.jsx(l,{"data-loc":"client/src/pages/CreateEstimate.tsx:498",type:"number",step:"0.01",value:s.taxRate,onChange:t=>i(a=>({...a,taxRate:t.target.value}))})]})]}),r.discountAmount>0&&e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:513",className:"flex justify-between text-sm",children:[e.jsx("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:514",className:"text-muted-foreground",children:"Discount"}),e.jsxs("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:515",className:"text-destructive",children:["-",s.currency," ",r.discountAmount.toFixed(2)]})]}),r.taxAmount>0&&e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:523",className:"flex justify-between text-sm",children:[e.jsxs("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:524",className:"text-muted-foreground",children:["Tax (",s.taxRate,"%)"]}),e.jsxs("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:527",children:[s.currency," ",r.taxAmount.toFixed(2)]})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:533",className:"flex justify-between text-lg font-bold pt-4 border-t",children:[e.jsx("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:534",children:"Total"}),e.jsxs("span",{"data-loc":"client/src/pages/CreateEstimate.tsx:535",children:[s.currency," ",r.total.toFixed(2)]})]})]})})]}),e.jsxs(v,{"data-loc":"client/src/pages/CreateEstimate.tsx:544",children:[e.jsx(y,{"data-loc":"client/src/pages/CreateEstimate.tsx:545",children:e.jsx(f,{"data-loc":"client/src/pages/CreateEstimate.tsx:546",children:"Notes & Terms"})}),e.jsxs(N,{"data-loc":"client/src/pages/CreateEstimate.tsx:548",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:549",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:550",htmlFor:"notes",children:"Notes"}),e.jsx(R,{"data-loc":"client/src/pages/CreateEstimate.tsx:551",id:"notes",placeholder:"Additional notes for the client...",value:s.notes,onChange:t=>i(a=>({...a,notes:t.target.value})),rows:3})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:562",className:"space-y-2",children:[e.jsx(n,{"data-loc":"client/src/pages/CreateEstimate.tsx:563",htmlFor:"terms",children:"Terms & Conditions"}),e.jsx(R,{"data-loc":"client/src/pages/CreateEstimate.tsx:564",id:"terms",placeholder:"Payment terms, conditions, etc...",value:s.terms,onChange:t=>i(a=>({...a,terms:t.target.value})),rows:3})]})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/CreateEstimate.tsx:578",className:"flex justify-end gap-4",children:[e.jsx(U,{"data-loc":"client/src/pages/CreateEstimate.tsx:579",href:"/estimates",children:e.jsx(u,{"data-loc":"client/src/pages/CreateEstimate.tsx:580",variant:"outline",children:"Cancel"})}),e.jsx(u,{"data-loc":"client/src/pages/CreateEstimate.tsx:582",onClick:$,disabled:I.isPending,children:I.isPending?e.jsxs(e.Fragment,{children:[e.jsx(_,{"data-loc":"client/src/pages/CreateEstimate.tsx:588",className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create Estimate"})]})]})]})})]}):(window.location.href=W(),null)}export{me as default};
