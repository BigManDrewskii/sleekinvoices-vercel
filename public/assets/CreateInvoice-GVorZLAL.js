import{r as o,j as e}from"./vendor-react-BuVtq312.js";import{c as a,t as _,D as K,e as Y,f as Z,h as ee,i as te,l as oe,B as se,b as ne,u as ie,w as ce,k as B,G as ae,g as re}from"./index-hzFfJlKH.js";import{P as le}from"./PageLayout-D7c6YbGr.js";import{T as de,g as X,I as me}from"./InvoiceForm-CZ6zX-SZ.js";import"./InvoiceFormCalculations-YZzX9-IS.js";import{R as ve,C as xe}from"./ClassicStyleInvoice-BMvk_NCN.js";import{P as ue}from"./PDFViewerModal-B9N2AWhL.js";import{ac as pe,b as ge,d as E,ah as fe,ai as Q,aj as he,ak as we,X as Ie}from"./vendor-icons-CPPAmKDz.js";import{U as Pe}from"./UpgradeDialog-B7ES_VUA.js";import"./vendor-data-DopHG4T0.js";import"./vendor-radix-DQBG9U-J.js";import"./Navigation-DKoTJDrW.js";import"./UserAvatar-DzPpP9tb.js";import"./label-DJDGx5UM.js";import"./textarea-CA7ezKjn.js";import"./select-BmfPitD4.js";import"./popover-BWvbcDDZ.js";import"./scroll-area-Dr7k8mI2.js";import"./CurrencySelector-CmxErqHw.js";import"./tabs-Bgk-_Zyf.js";import"./index.browser-OxPLOBIU.js";import"./ClientDialog-Ch_MRpgo.js";import"./checkbox-Cacebbmr.js";import"./typography-CdqW54LS.js";import"./vendor-date-B2OJh1lx.js";import"./subscription-B5lMhqL4.js";const z=794,be=1123,Ne=be/z;function je({children:d,format:r="a4",device:m="desktop",className:w,showPageBorder:x=!0,showShadow:y=!0,maxHeight:I="80vh"}){const i=o.useRef(null),[u,k]=o.useState(1),P={desktop:z,tablet:600,mobile:375},s={a4:{width:z,aspectRatio:Ne},web:{width:P[m]},email:{width:600}}[r],n=Math.min(s.width,P[m]);return o.useEffect(()=>{const b=()=>{if(!i.current)return;const C=i.current.clientWidth-48,N=i.current.clientHeight-48;let l=C/n;if(r==="a4"&&s.aspectRatio){const S=n*s.aspectRatio,j=N/S;l=Math.min(l,j)}l=Math.max(.3,Math.min(1.2,l)),k(l)};b();const p=new ResizeObserver(b);return i.current&&p.observe(i.current),()=>p.disconnect()},[n,r,s.aspectRatio]),e.jsxs("div",{"data-loc":"client/src/components/invoices/A4PreviewContainer.tsx:92",ref:i,className:a("relative flex items-start justify-center overflow-auto","bg-zinc-100 dark:bg-zinc-900 rounded-xl p-6",w),style:{maxHeight:I},children:[e.jsx("div",{"data-loc":"client/src/components/invoices/A4PreviewContainer.tsx:101",className:"origin-top transition-transform duration-200",style:{transform:`scale(${u})`,width:n,minHeight:r==="a4"&&s.aspectRatio?n*s.aspectRatio:"auto"},children:e.jsx("div",{"data-loc":"client/src/components/invoices/A4PreviewContainer.tsx:112",className:a("bg-white",x&&"border border-zinc-200",y&&"shadow-[0_4px_20px_rgba(0,0,0,0.08),0_0_1px_rgba(0,0,0,0.1)]","rounded-sm overflow-hidden"),style:{width:n,minHeight:r==="a4"&&s.aspectRatio?n*s.aspectRatio:"auto"},children:d})}),e.jsxs("div",{"data-loc":"client/src/components/invoices/A4PreviewContainer.tsx:132",className:"absolute bottom-3 right-3 text-[10px] font-mono text-zinc-400 bg-white/80 px-2 py-1 rounded",children:[Math.round(u*100),"%"]})]})}function Me({open:d,onClose:r,invoiceNumber:m,clientName:w,clientEmail:x,clientAddress:y,issueDate:I,dueDate:i,lineItems:u,subtotal:k,discountAmount:P,taxAmount:A,taxRate:s=0,total:n,notes:b,paymentTerms:p,companyName:C,companyAddress:N,companyEmail:l,companyPhone:S,taxId:j,status:R="draft",templateId:H,onTemplateChange:T,pdfUrl:t}){const[v,F]=o.useState(H||null),[c,M]=o.useState("receipt"),[g,f]=o.useState("a4"),[h,L]=o.useState("desktop"),[V,O]=o.useState(!1),{data:G}=_.templates.list.useQuery(),U=v?G?.find(D=>D.id===v):G?.find(D=>D.isDefault),W=U?.primaryColor||"#18181b",q=U?.accentColor||"#5f6fff",$=U?.logoUrl,J=D=>{F(D),T?.(D)};return e.jsx(K,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:130",open:d,onOpenChange:r,children:e.jsxs(Y,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:131",className:"max-w-5xl max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsxs(Z,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:132",className:"shrink-0",children:[e.jsxs(ee,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:133",className:"flex items-center gap-2",children:[e.jsx(pe,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:134",className:"h-5 w-5"}),"Invoice Preview"]}),e.jsx(te,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:137",children:"Preview your invoice in different formats and styles before saving."})]}),e.jsxs(oe,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:142",className:"flex-1 overflow-hidden flex flex-col",children:[e.jsxs("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:144",className:"flex flex-col lg:flex-row items-start lg:items-center gap-4 mb-4 pb-4 border-b shrink-0",children:[e.jsxs("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:146",className:"flex items-center gap-2",children:[e.jsx("span",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:147",className:"text-xs font-medium text-muted-foreground",children:"Style:"}),e.jsxs("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:150",className:"flex bg-muted/50 p-0.5 rounded-lg",children:[e.jsxs("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:151",onClick:()=>M("receipt"),className:a("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all",c==="receipt"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(ge,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:160",className:"h-3.5 w-3.5"}),"Receipt"]}),e.jsxs("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:163",onClick:()=>M("classic"),className:a("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all",c==="classic"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(E,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:172",className:"h-3.5 w-3.5"}),"Classic"]}),t&&e.jsxs("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:176",onClick:()=>{M("generated"),O(!0)},className:a("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all",c==="generated"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(E,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:188",className:"h-3.5 w-3.5"}),"Generated PDF"]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:196",className:"flex items-center gap-2",children:[e.jsx("span",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:197",className:"text-xs font-medium text-muted-foreground",children:"Format:"}),e.jsxs("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:200",className:"flex bg-muted/50 p-0.5 rounded-lg",children:[e.jsxs("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:201",onClick:()=>f("a4"),className:a("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all",g==="a4"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(fe,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:210",className:"h-3.5 w-3.5"}),"A4/PDF"]}),e.jsxs("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:213",onClick:()=>f("web"),className:a("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all",g==="web"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Q,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:222",className:"h-3.5 w-3.5"}),"Web"]}),e.jsxs("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:225",onClick:()=>f("email"),className:a("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-xs font-medium transition-all",g==="email"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(E,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:234",className:"h-3.5 w-3.5"}),"Email"]})]})]}),g==="web"&&e.jsxs("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:242",className:"flex items-center gap-2",children:[e.jsx("span",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:243",className:"text-xs font-medium text-muted-foreground",children:"Device:"}),e.jsxs("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:246",className:"flex gap-1",children:[e.jsx("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:247",onClick:()=>L("mobile"),title:"Mobile",className:a("p-1.5 rounded-md transition-all",h==="mobile"?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:e.jsx(he,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:257",className:"h-4 w-4"})}),e.jsx("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:259",onClick:()=>L("tablet"),title:"Tablet",className:a("p-1.5 rounded-md transition-all",h==="tablet"?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:e.jsx(we,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:269",className:"h-4 w-4"})}),e.jsx("button",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:271",onClick:()=>L("desktop"),title:"Desktop",className:a("p-1.5 rounded-md transition-all",h==="desktop"?"bg-muted text-foreground":"text-muted-foreground hover:text-foreground hover:bg-muted/50"),children:e.jsx(Q,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:281",className:"h-4 w-4"})})]})]}),c==="classic"&&e.jsx("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:289",className:"flex-1 w-full lg:w-auto lg:max-w-[200px] ml-auto",children:e.jsx(de,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:290",value:v,onChange:J})})]}),e.jsx("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:299",className:"flex-1 overflow-hidden",children:c==="generated"&&t?e.jsx("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:301",className:"h-full flex flex-col",children:e.jsx(ue,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:302",open:V,onOpenChange:O,pdfUrl:t,fileName:`Invoice-${m}.pdf`})}):e.jsx(je,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:310",format:g,device:h,maxHeight:"calc(95vh - 280px)",className:"h-full",children:c==="receipt"?e.jsx(ve,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:317",invoiceNumber:m,clientName:w,clientEmail:x,clientAddress:y,issueDate:I,dueDate:i,lineItems:u,subtotal:k,discountAmount:P,taxAmount:A,taxRate:s,total:n,notes:b,paymentTerms:p,companyName:C,companyAddress:N,companyEmail:l,companyPhone:S,taxId:j,status:R,logoUrl:$||void 0,primaryColor:W,accentColor:q}):e.jsx(xe,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:343",invoiceNumber:m,clientName:w,clientEmail:x,clientAddress:y,issueDate:I,dueDate:i,lineItems:u,subtotal:k,discountAmount:P,taxAmount:A,taxRate:s,total:n,notes:b,paymentTerms:p,companyName:C,companyAddress:N,companyEmail:l,companyPhone:S,taxId:j,status:R,logoUrl:$||void 0,primaryColor:W,accentColor:q})})}),e.jsx("div",{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:374",className:"flex justify-end gap-3 pt-4 border-t mt-4 shrink-0",children:e.jsxs(se,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:375",variant:"outline",onClick:r,children:[e.jsx(Ie,{"data-loc":"client/src/components/invoices/InvoicePreviewModal.tsx:376",className:"h-4 w-4 mr-2"}),"Close"]})})]})]})})}function Ye(){const{user:d,loading:r,isAuthenticated:m}=ne(),[,w]=ie(),x=ce(),[y,I]=o.useState(!1),[i,u]=o.useState(!1),[k,P]=o.useState(null),[A,s]=o.useState("USD"),[n,b]=o.useState(null),[p,C]=o.useState(""),[N,l]=o.useState([]);o.useEffect(()=>{if(!x)return;const t=new URLSearchParams(x),v=t.get("clientName");v&&v!=="null"&&P(v);const F=t.get("currency");F&&F!=="null"&&s(F);const c=t.get("dueDate");c&&c!=="null"&&c.match(/^\d{4}-\d{2}-\d{2}$/)&&b(c);const M=t.get("notes");M&&M!=="null"&&C(M);const g=t.get("lineItems");if(g)try{const f=JSON.parse(g);Array.isArray(f)&&f.length>0&&l(f.map(h=>({description:h.description||"",quantity:h.quantity||1,rate:h.rate||0})))}catch{}},[x]);const S=_.useUtils(),j=_.invoices.create.useMutation({onSuccess:t=>{B.success("Invoice created successfully"),S.invoices.list.invalidate(),w(`/invoices/${t.id}`)},onError:t=>{t.message?.includes("Monthly invoice limit reached")||t.message?.includes("invoice limit")?I(!0):B.error(t.message||"Failed to create invoice")}}),{data:R}=_.invoices.getNextNumber.useQuery(void 0,{enabled:m}),H=async(t,v)=>{j.mutate({...t,status:v})};if(r)return e.jsx("div",{"data-loc":"client/src/pages/CreateInvoice.tsx:125",className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{"data-loc":"client/src/pages/CreateInvoice.tsx:126",className:"opacity-70",children:e.jsx(ae,{"data-loc":"client/src/pages/CreateInvoice.tsx:127",size:"md"})})});if(!m)return window.location.href=re(),null;const T={currency:A,dueDate:n||void 0,notes:p||void 0,lineItems:N.length>0?N.map(t=>({...X(),description:t.description,quantity:t.quantity,rate:t.rate})):void 0};return e.jsxs(e.Fragment,{children:[e.jsx(le,{"data-loc":"client/src/pages/CreateInvoice.tsx:155",narrow:!0,title:"Create Invoice",subtitle:"Fill in the details to create a new invoice",children:e.jsx(me,{"data-loc":"client/src/pages/CreateInvoice.tsx:160",mode:"create",initialData:T,invoiceNumber:R||void 0,onSubmit:H,onCancel:()=>w("/invoices"),isLoading:j.isPending,showPreview:i,onPreviewChange:u,previewData:d?{clientName:"Client Name",companyName:d.companyName??void 0,companyAddress:d.companyAddress??void 0}:void 0})}),e.jsx(Me,{"data-loc":"client/src/pages/CreateInvoice.tsx:181",open:i,onClose:()=>u(!1),invoiceNumber:R||"INV-0001",clientName:"Client Name",issueDate:new Date,dueDate:new Date(n||Date.now()+720*60*60*1e3),lineItems:T.lineItems||[X()],subtotal:0,discountAmount:0,taxAmount:0,total:0,notes:p,paymentTerms:"Net 30",companyName:d?.companyName??void 0,companyAddress:d?.companyAddress??void 0,templateId:void 0,onTemplateChange:()=>{}}),e.jsx(Pe,{"data-loc":"client/src/pages/CreateInvoice.tsx:203",open:y,onOpenChange:I,reason:"invoice_limit"})]})}export{Ye as default};
