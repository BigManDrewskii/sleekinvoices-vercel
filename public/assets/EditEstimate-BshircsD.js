import{r as h,j as t}from"./vendor-react-BuVtq312.js";import{b as Y,u as Z,y as _,t as f,k as N,G as tt,g as et,L as R,B as p,C as b,z as C,A as D,a as I,I as n}from"./index-hzFfJlKH.js";import{L as r}from"./label-DJDGx5UM.js";import{T as P}from"./textarea-CA7ezKjn.js";import{S as w,a as F,b as S,c as A,d as o}from"./select-BmfPitD4.js";import{N as q}from"./Navigation-DKoTJDrW.js";import{z as k,a2 as st,a8 as at,L as it}from"./vendor-icons-CPPAmKDz.js";import{f as $}from"./vendor-date-B2OJh1lx.js";import"./vendor-data-DopHG4T0.js";import"./vendor-radix-DQBG9U-J.js";import"./UserAvatar-DzPpP9tb.js";function gt(){const{loading:z,isAuthenticated:j}=Y(),[,B]=Z(),M=_(),m=parseInt(M.id||"0"),[a,l]=h.useState({clientId:"",title:"",currency:"USD",taxRate:"0",discountType:"percentage",discountValue:"0",notes:"",terms:"",issueDate:"",validUntil:""}),[x,u]=h.useState([]),[V,G]=h.useState(!1),{data:c,isLoading:Q}=f.estimates.get.useQuery({id:m},{enabled:j&&m>0}),{data:H}=f.clients.list.useQuery(void 0,{enabled:j}),{data:v}=f.products.list.useQuery(void 0,{enabled:j}),T=f.estimates.update.useMutation({onSuccess:()=>{N.success("Estimate updated successfully"),B(`/estimates/${m}`)},onError:e=>{N.error(e.message||"Failed to update estimate")}});h.useEffect(()=>{c&&!V&&(l({clientId:c.estimate.clientId.toString(),title:c.estimate.title||"",currency:c.estimate.currency,taxRate:c.estimate.taxRate,discountType:c.estimate.discountType||"percentage",discountValue:c.estimate.discountValue,notes:c.estimate.notes||"",terms:c.estimate.terms||"",issueDate:$(new Date(c.estimate.issueDate),"yyyy-MM-dd"),validUntil:$(new Date(c.estimate.validUntil),"yyyy-MM-dd")}),u(c.lineItems.map((e,s)=>({id:e.id.toString(),description:e.description,quantity:e.quantity,rate:e.rate,amount:e.amount}))),G(!0))},[c,V]);const d=h.useMemo(()=>{const e=x.reduce((E,U)=>E+(parseFloat(U.amount)||0),0);let s=0;a.discountType==="percentage"?s=e*(parseFloat(a.discountValue)||0)/100:s=parseFloat(a.discountValue)||0;const i=e-s,y=i*(parseFloat(a.taxRate)||0)/100,g=i+y;return{subtotal:e,discountAmount:s,taxAmount:y,total:g}},[x,a.discountType,a.discountValue,a.taxRate]),L=(e,s,i)=>{u(y=>y.map(g=>{if(g.id!==e)return g;const E={...g,[s]:i};if(s==="quantity"||s==="rate"){const U=parseFloat(E.quantity)||0,X=parseFloat(E.rate)||0;E.amount=(U*X).toFixed(2)}return E}))},O=()=>{u(e=>[...e,{id:`new-${Date.now()}`,description:"",quantity:"1",rate:"",amount:"0"}])},W=e=>{x.length!==1&&u(s=>s.filter(i=>i.id!==e))},J=e=>{const s=v?.find(i=>i.id===parseInt(e));s&&u(i=>[...i,{id:`new-${Date.now()}`,description:s.description||s.name,quantity:"1",rate:s.rate,amount:s.rate}])},K=()=>{if(!a.clientId){N.error("Please select a client");return}const e=x.filter(s=>s.description&&parseFloat(s.amount)>0);if(e.length===0){N.error("Please add at least one line item");return}T.mutate({id:m,clientId:parseInt(a.clientId),title:a.title||null,currency:a.currency,subtotal:d.subtotal.toFixed(2),taxRate:a.taxRate,taxAmount:d.taxAmount.toFixed(2),discountType:a.discountType,discountValue:a.discountValue,discountAmount:d.discountAmount.toFixed(2),total:d.total.toFixed(2),notes:a.notes||null,terms:a.terms||null,issueDate:new Date(a.issueDate),validUntil:new Date(a.validUntil),lineItems:e.map(s=>({description:s.description,quantity:s.quantity,rate:s.rate,amount:s.amount}))})};return z||Q?t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:229",className:"min-h-screen flex items-center justify-center bg-background",children:t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:230",className:"opacity-70",children:t.jsx(tt,{"data-loc":"client/src/pages/EditEstimate.tsx:231",size:"md"})})}):j?c?t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:262",className:"min-h-screen bg-background",children:[t.jsx(q,{"data-loc":"client/src/pages/EditEstimate.tsx:263"}),t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:265",className:"container mx-auto px-4 py-8",children:t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:266",className:"max-w-4xl mx-auto",children:[t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:268",className:"flex items-center gap-4 mb-8",children:[t.jsx(R,{"data-loc":"client/src/pages/EditEstimate.tsx:269",href:`/estimates/${m}`,children:t.jsxs(p,{"data-loc":"client/src/pages/EditEstimate.tsx:270",variant:"ghost",size:"sm",children:[t.jsx(k,{"data-loc":"client/src/pages/EditEstimate.tsx:271",className:"h-4 w-4 mr-2"}),"Back"]})}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:275",children:[t.jsx("h1",{"data-loc":"client/src/pages/EditEstimate.tsx:276",className:"text-3xl font-bold text-foreground",children:"Edit Estimate"}),t.jsx("p",{"data-loc":"client/src/pages/EditEstimate.tsx:279",className:"text-muted-foreground",children:c.estimate.estimateNumber})]})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:285",className:"space-y-6",children:[t.jsxs(b,{"data-loc":"client/src/pages/EditEstimate.tsx:287",children:[t.jsx(C,{"data-loc":"client/src/pages/EditEstimate.tsx:288",children:t.jsx(D,{"data-loc":"client/src/pages/EditEstimate.tsx:289",children:"Estimate Details"})}),t.jsxs(I,{"data-loc":"client/src/pages/EditEstimate.tsx:291",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:292",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:293",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:294",htmlFor:"client",children:"Client *"}),t.jsxs(w,{"data-loc":"client/src/pages/EditEstimate.tsx:295",value:a.clientId,onValueChange:e=>l(s=>({...s,clientId:e})),children:[t.jsx(F,{"data-loc":"client/src/pages/EditEstimate.tsx:301",children:t.jsx(S,{"data-loc":"client/src/pages/EditEstimate.tsx:302",placeholder:"Select a client"})}),t.jsx(A,{"data-loc":"client/src/pages/EditEstimate.tsx:304",children:H?.map(e=>t.jsxs(o,{"data-loc":"client/src/pages/EditEstimate.tsx:306",value:e.id.toString(),children:[e.name,e.companyName&&` (${e.companyName})`]},e.id))})]})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:318",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:319",htmlFor:"currency",children:"Currency"}),t.jsxs(w,{"data-loc":"client/src/pages/EditEstimate.tsx:320",value:a.currency,onValueChange:e=>l(s=>({...s,currency:e})),children:[t.jsx(F,{"data-loc":"client/src/pages/EditEstimate.tsx:326",children:t.jsx(S,{"data-loc":"client/src/pages/EditEstimate.tsx:327"})}),t.jsxs(A,{"data-loc":"client/src/pages/EditEstimate.tsx:329",children:[t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:330",value:"USD",children:"USD - US Dollar"}),t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:331",value:"EUR",children:"EUR - Euro"}),t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:332",value:"GBP",children:"GBP - British Pound"}),t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:333",value:"CAD",children:"CAD - Canadian Dollar"}),t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:336",value:"AUD",children:"AUD - Australian Dollar"})]})]})]})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:344",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:345",htmlFor:"title",children:"Title / Subject (optional)"}),t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:346",id:"title",placeholder:"e.g., Website Redesign Proposal",value:a.title,onChange:e=>l(s=>({...s,title:e.target.value}))})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:356",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:357",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:358",htmlFor:"issueDate",children:"Issue Date"}),t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:359",id:"issueDate",type:"date",value:a.issueDate,onChange:e=>l(s=>({...s,issueDate:e.target.value}))})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:372",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:373",htmlFor:"validUntil",children:"Valid Until"}),t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:374",id:"validUntil",type:"date",value:a.validUntil,onChange:e=>l(s=>({...s,validUntil:e.target.value}))})]})]})]})]}),t.jsxs(b,{"data-loc":"client/src/pages/EditEstimate.tsx:391",children:[t.jsx(C,{"data-loc":"client/src/pages/EditEstimate.tsx:392",children:t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:393",className:"flex items-center justify-between",children:[t.jsx(D,{"data-loc":"client/src/pages/EditEstimate.tsx:394",children:"Line Items"}),v&&v.length>0&&t.jsxs(w,{"data-loc":"client/src/pages/EditEstimate.tsx:396",onValueChange:J,children:[t.jsx(F,{"data-loc":"client/src/pages/EditEstimate.tsx:397",className:"w-[200px]",children:t.jsx(S,{"data-loc":"client/src/pages/EditEstimate.tsx:398",placeholder:"Add from products"})}),t.jsx(A,{"data-loc":"client/src/pages/EditEstimate.tsx:400",children:v.map(e=>t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:402",value:e.id.toString(),children:e.name},e.id))})]})]})}),t.jsx(I,{"data-loc":"client/src/pages/EditEstimate.tsx:414",children:t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:415",className:"space-y-4",children:[x.map((e,s)=>t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:417",className:"grid grid-cols-12 gap-2 items-start",children:[t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:421",className:"col-span-12 md:col-span-5",children:t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:422",placeholder:"Description",value:e.description,onChange:i=>L(e.id,"description",i.target.value)})}),t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:434",className:"col-span-4 md:col-span-2",children:t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:435",type:"number",placeholder:"Qty",value:e.quantity,onChange:i=>L(e.id,"quantity",i.target.value)})}),t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:444",className:"col-span-4 md:col-span-2",children:t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:445",type:"number",step:"0.01",placeholder:"Rate",value:e.rate,onChange:i=>L(e.id,"rate",i.target.value)})}),t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:455",className:"col-span-3 md:col-span-2",children:t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:456",readOnly:!0,value:`${a.currency} ${e.amount}`,className:"bg-muted"})}),t.jsx("div",{"data-loc":"client/src/pages/EditEstimate.tsx:462",className:"col-span-1",children:t.jsx(p,{"data-loc":"client/src/pages/EditEstimate.tsx:463",variant:"ghost",size:"icon",onClick:()=>W(e.id),disabled:x.length===1,"aria-label":`Remove line item: ${e.description||"Item "+(s+1)}`,children:t.jsx(st,{"data-loc":"client/src/pages/EditEstimate.tsx:470",className:"h-4 w-4 text-muted-foreground"})})})]},e.id)),t.jsxs(p,{"data-loc":"client/src/pages/EditEstimate.tsx:476",variant:"outline",onClick:O,className:"w-full",children:[t.jsx(at,{"data-loc":"client/src/pages/EditEstimate.tsx:481",className:"h-4 w-4 mr-2"}),"Add Line Item"]})]})})]}),t.jsxs(b,{"data-loc":"client/src/pages/EditEstimate.tsx:489",children:[t.jsx(C,{"data-loc":"client/src/pages/EditEstimate.tsx:490",children:t.jsx(D,{"data-loc":"client/src/pages/EditEstimate.tsx:491",children:"Totals"})}),t.jsx(I,{"data-loc":"client/src/pages/EditEstimate.tsx:493",children:t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:494",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:495",className:"flex justify-between",children:[t.jsx("span",{"data-loc":"client/src/pages/EditEstimate.tsx:496",className:"text-muted-foreground",children:"Subtotal"}),t.jsxs("span",{"data-loc":"client/src/pages/EditEstimate.tsx:497",className:"font-medium",children:[a.currency," ",d.subtotal.toFixed(2)]})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:502",className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:503",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:504",children:"Discount"}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:505",className:"flex gap-2",children:[t.jsxs(w,{"data-loc":"client/src/pages/EditEstimate.tsx:506",value:a.discountType,onValueChange:e=>l(s=>({...s,discountType:e})),children:[t.jsx(F,{"data-loc":"client/src/pages/EditEstimate.tsx:515",className:"w-[100px]",children:t.jsx(S,{"data-loc":"client/src/pages/EditEstimate.tsx:516"})}),t.jsxs(A,{"data-loc":"client/src/pages/EditEstimate.tsx:518",children:[t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:519",value:"percentage",children:"%"}),t.jsx(o,{"data-loc":"client/src/pages/EditEstimate.tsx:520",value:"fixed",children:a.currency})]})]}),t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:525",type:"number",step:"0.01",value:a.discountValue,onChange:e=>l(s=>({...s,discountValue:e.target.value}))})]})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:539",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:540",children:"Tax Rate (%)"}),t.jsx(n,{"data-loc":"client/src/pages/EditEstimate.tsx:541",type:"number",step:"0.01",value:a.taxRate,onChange:e=>l(s=>({...s,taxRate:e.target.value}))})]})]}),d.discountAmount>0&&t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:556",className:"flex justify-between text-sm",children:[t.jsx("span",{"data-loc":"client/src/pages/EditEstimate.tsx:557",className:"text-muted-foreground",children:"Discount"}),t.jsxs("span",{"data-loc":"client/src/pages/EditEstimate.tsx:558",className:"text-destructive",children:["-",a.currency," ",d.discountAmount.toFixed(2)]})]}),d.taxAmount>0&&t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:566",className:"flex justify-between text-sm",children:[t.jsxs("span",{"data-loc":"client/src/pages/EditEstimate.tsx:567",className:"text-muted-foreground",children:["Tax (",a.taxRate,"%)"]}),t.jsxs("span",{"data-loc":"client/src/pages/EditEstimate.tsx:570",children:[a.currency," ",d.taxAmount.toFixed(2)]})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:576",className:"flex justify-between text-lg font-bold pt-4 border-t",children:[t.jsx("span",{"data-loc":"client/src/pages/EditEstimate.tsx:577",children:"Total"}),t.jsxs("span",{"data-loc":"client/src/pages/EditEstimate.tsx:578",children:[a.currency," ",d.total.toFixed(2)]})]})]})})]}),t.jsxs(b,{"data-loc":"client/src/pages/EditEstimate.tsx:587",children:[t.jsx(C,{"data-loc":"client/src/pages/EditEstimate.tsx:588",children:t.jsx(D,{"data-loc":"client/src/pages/EditEstimate.tsx:589",children:"Notes & Terms"})}),t.jsxs(I,{"data-loc":"client/src/pages/EditEstimate.tsx:591",className:"space-y-4",children:[t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:592",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:593",htmlFor:"notes",children:"Notes"}),t.jsx(P,{"data-loc":"client/src/pages/EditEstimate.tsx:594",id:"notes",placeholder:"Additional notes for the client...",value:a.notes,onChange:e=>l(s=>({...s,notes:e.target.value})),rows:3})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:605",className:"space-y-2",children:[t.jsx(r,{"data-loc":"client/src/pages/EditEstimate.tsx:606",htmlFor:"terms",children:"Terms & Conditions"}),t.jsx(P,{"data-loc":"client/src/pages/EditEstimate.tsx:607",id:"terms",placeholder:"Payment terms, conditions, etc...",value:a.terms,onChange:e=>l(s=>({...s,terms:e.target.value})),rows:3})]})]})]}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:621",className:"flex justify-end gap-4",children:[t.jsx(R,{"data-loc":"client/src/pages/EditEstimate.tsx:622",href:`/estimates/${m}`,children:t.jsx(p,{"data-loc":"client/src/pages/EditEstimate.tsx:623",variant:"outline",children:"Cancel"})}),t.jsx(p,{"data-loc":"client/src/pages/EditEstimate.tsx:625",onClick:K,disabled:T.isPending,children:T.isPending?t.jsxs(t.Fragment,{children:[t.jsx(it,{"data-loc":"client/src/pages/EditEstimate.tsx:631",className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):"Save Changes"})]})]})]})})]}):t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:244",className:"min-h-screen bg-background",children:[t.jsx(q,{"data-loc":"client/src/pages/EditEstimate.tsx:245"}),t.jsxs("div",{"data-loc":"client/src/pages/EditEstimate.tsx:246",className:"container mx-auto px-4 md:px-6 py-12 md:py-16 text-center",children:[t.jsx("h1",{"data-loc":"client/src/pages/EditEstimate.tsx:247",className:"text-2xl font-bold text-foreground mb-4",children:"Estimate Not Found"}),t.jsx(R,{"data-loc":"client/src/pages/EditEstimate.tsx:250",href:"/estimates",children:t.jsxs(p,{"data-loc":"client/src/pages/EditEstimate.tsx:251",children:[t.jsx(k,{"data-loc":"client/src/pages/EditEstimate.tsx:252",className:"h-4 w-4 mr-2"}),"Back to Estimates"]})})]})]}):(window.location.href=et(),null)}export{gt as default};
