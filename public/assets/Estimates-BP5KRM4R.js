import{r,j as s}from"./vendor-react-BuVtq312.js";import{b as fs,u as bs,t as o,k as g,G as Ss,g as Ns,L as C,B as f,C as ws,z as Ds,A as ys,E as Cs,a as Ts,m as K,v as O,j as ks}from"./index-hzFfJlKH.js";import{T as As,a as Is,b as q,c as H,d as Ms,e as d}from"./table-y7wtTQEZ.js";import{D as Ls}from"./DeleteConfirmDialog-BLT6kY2H.js";import{N as Fs,D as Ps,a as Rs,b as zs,c as n,d as G}from"./Navigation-DKoTJDrW.js";import{E as Vs}from"./PageSkeletons-DirSuB2s.js";import{E as Q,a as W}from"./EmptyState-B5hZ-p_K.js";import{S as X,a as Y,b as J,c as Z,d as l}from"./select-BmfPitD4.js";import{S as Us,a as b,P as $s}from"./scrollable-table-wrapper-nwSnGFpJ.js";import{u as _s,F as Bs,a as ss}from"./useTableSort-BKzs4CS_.js";import{u as Ks}from"./useUndoableDelete-CCCtPilo.js";import{a8 as es,aL as Os,ac as T,a0 as qs,an as cs,aq as is,aD as ls,A as k,d as rs,a2 as ts,l as Hs}from"./vendor-icons-CPPAmKDz.js";import"./vendor-data-DopHG4T0.js";import"./vendor-radix-DQBG9U-J.js";import"./alert-dialog-nKHsLnMc.js";import"./UserAvatar-DzPpP9tb.js";import"./skeleton-QN8DVCY2.js";import"./PageLayout-D7c6YbGr.js";const as={draft:{label:"Draft",variant:"secondary",icon:rs},sent:{label:"Sent",variant:"default",icon:cs},viewed:{label:"Viewed",variant:"outline",icon:T},accepted:{label:"Accepted",variant:"default",icon:is},rejected:{label:"Rejected",variant:"destructive",icon:ls},expired:{label:"Expired",variant:"secondary",icon:Hs},converted:{label:"Converted",variant:"default",icon:k}};function me(){const{loading:ns,isAuthenticated:A}=fs(),[,m]=bs(),[x,I]=r.useState(""),[p,M]=r.useState("all"),[u,L]=r.useState("all"),[os,w]=r.useState(!1),[D,F]=r.useState(null),[y,S]=r.useState(1),[N,ds]=r.useState(25),{sort:E,handleSort:h,sortData:P}=_s({defaultKey:"issueDate",defaultDirection:"desc"}),{data:j,isLoading:ms}=o.estimates.list.useQuery(void 0,{enabled:A}),c=o.useUtils(),R=o.estimates.delete.useMutation({onSuccess:()=>{},onError:e=>{c.estimates.list.invalidate(),g.error(e.message||"Failed to delete estimate. Item has been restored.")}}),{executeDelete:xs}=Ks(),ps=e=>{const t=c.estimates.list.getData();xs({item:e,itemName:e.estimateNumber,itemType:"estimate",onOptimisticDelete:()=>{c.estimates.list.setData(void 0,a=>a?.filter(i=>i.id!==e.id)),w(!1),F(null)},onRestore:()=>{t?c.estimates.list.setData(void 0,t):c.estimates.list.invalidate()},onConfirmDelete:async()=>{await R.mutateAsync({id:e.id})}})},z=o.estimates.convertToInvoice.useMutation({onSuccess:e=>{g.success(`Converted to invoice ${e.invoiceNumber}`),c.estimates.list.invalidate(),m(`/invoices/${e.invoiceId}`)},onError:e=>{g.error(e.message||"Failed to convert estimate")}}),us=o.estimates.markAsSent.useMutation({onMutate:async({id:e})=>{await c.estimates.list.cancel();const t=c.estimates.list.getData();return c.estimates.list.setData(void 0,a=>a?.map(i=>i.id===e?{...i,status:"sent"}:i)),{previousEstimates:t}},onSuccess:()=>{g.success("Estimate marked as sent")},onError:(e,t,a)=>{a?.previousEstimates&&c.estimates.list.setData(void 0,a.previousEstimates)},onSettled:()=>{c.estimates.list.invalidate()}}),gs=o.estimates.markAsAccepted.useMutation({onMutate:async({id:e})=>{await c.estimates.list.cancel();const t=c.estimates.list.getData();return c.estimates.list.setData(void 0,a=>a?.map(i=>i.id===e?{...i,status:"accepted"}:i)),{previousEstimates:t}},onSuccess:()=>{g.success("Estimate marked as accepted")},onError:(e,t,a)=>{a?.previousEstimates&&c.estimates.list.setData(void 0,a.previousEstimates)},onSettled:()=>{c.estimates.list.invalidate()}}),Es=o.estimates.markAsRejected.useMutation({onMutate:async({id:e})=>{await c.estimates.list.cancel();const t=c.estimates.list.getData();return c.estimates.list.setData(void 0,a=>a?.map(i=>i.id===e?{...i,status:"rejected"}:i)),{previousEstimates:t}},onSuccess:()=>{g.success("Estimate marked as rejected")},onError:(e,t,a)=>{a?.previousEstimates&&c.estimates.list.setData(void 0,a.previousEstimates)},onSettled:()=>{c.estimates.list.invalidate()}});if(ns)return s.jsx("div",{"data-loc":"client/src/pages/Estimates.tsx:249",className:"min-h-screen flex items-center justify-center bg-background",children:s.jsx("div",{"data-loc":"client/src/pages/Estimates.tsx:250",className:"opacity-70",children:s.jsx(Ss,{"data-loc":"client/src/pages/Estimates.tsx:251",size:"md"})})});if(!A)return window.location.href=Ns(),null;const v=r.useMemo(()=>{if(!j)return[];let e=[...j];if(x){const t=x.toLowerCase();e=e.filter(a=>a.estimateNumber.toLowerCase().includes(t)||a.clientName?.toLowerCase().includes(t)||a.title?.toLowerCase().includes(t))}if(p!=="all"&&(e=e.filter(t=>t.status===p)),u!=="all"){const t=new Date;e=e.filter(a=>{const i=new Date(a.issueDate);switch(u){case"today":return i.toDateString()===t.toDateString();case"7days":return i>=new Date(t.getTime()-10080*60*1e3);case"30days":return i>=new Date(t.getTime()-720*60*60*1e3);case"90days":return i>=new Date(t.getTime()-2160*60*60*1e3);case"year":return i>=new Date(t.getTime()-365*24*60*60*1e3);default:return!0}})}return P(e)},[j,x,p,u,P]),V=v.length,U=Math.ceil(V/N),$=v.slice((y-1)*N,y*N);r.useEffect(()=>{S(1)},[x,p,u]);const hs=()=>{I(""),M("all"),L("all"),S(1)},js=!!(x||p!=="all"||u!=="all"),_=e=>{F(e),w(!0)},vs=()=>{D&&ps(D)},B=e=>{const t=as[e]||as.draft,a=t.icon;return s.jsxs(ks,{"data-loc":"client/src/pages/Estimates.tsx:361",variant:t.variant,className:"flex items-center gap-1 w-fit",children:[s.jsx(a,{"data-loc":"client/src/pages/Estimates.tsx:362",className:"h-3 w-3"}),t.label]})};return s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:369",className:"min-h-screen bg-background",children:[s.jsx(Fs,{"data-loc":"client/src/pages/Estimates.tsx:370"}),s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:372",className:"container mx-auto px-4 py-6 md:py-8",children:[s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:373",className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 md:mb-8",children:[s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:374",children:[s.jsx("h1",{"data-loc":"client/src/pages/Estimates.tsx:375",className:"text-2xl sm:text-3xl font-bold text-foreground",children:"Estimates"}),s.jsx("p",{"data-loc":"client/src/pages/Estimates.tsx:378",className:"text-sm sm:text-base text-muted-foreground",children:"Create quotes and convert them to invoices"})]}),s.jsx(C,{"data-loc":"client/src/pages/Estimates.tsx:382",href:"/estimates/create",children:s.jsxs(f,{"data-loc":"client/src/pages/Estimates.tsx:383",className:"w-full sm:w-auto",children:[s.jsx(es,{"data-loc":"client/src/pages/Estimates.tsx:384",className:"h-4 w-4 mr-2"}),"New Estimate"]})})]}),s.jsx(Bs,{"data-loc":"client/src/pages/Estimates.tsx:391",hasActiveFilters:js,onClearFilters:hs,searchValue:x,onSearchChange:I,searchPlaceholder:"Search estimates by number, client, or title...",children:s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:398",className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 w-full",children:[s.jsx(ss,{"data-loc":"client/src/pages/Estimates.tsx:400",label:"Status",children:s.jsxs(X,{"data-loc":"client/src/pages/Estimates.tsx:401",value:p,onValueChange:M,children:[s.jsx(Y,{"data-loc":"client/src/pages/Estimates.tsx:402",children:s.jsx(J,{"data-loc":"client/src/pages/Estimates.tsx:403",placeholder:"All Status"})}),s.jsxs(Z,{"data-loc":"client/src/pages/Estimates.tsx:405",children:[s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:406",value:"all",children:"All Status"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:407",value:"draft",children:"Draft"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:408",value:"sent",children:"Sent"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:409",value:"viewed",children:"Viewed"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:410",value:"accepted",children:"Accepted"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:411",value:"rejected",children:"Rejected"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:412",value:"expired",children:"Expired"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:413",value:"converted",children:"Converted"})]})]})}),s.jsx(ss,{"data-loc":"client/src/pages/Estimates.tsx:419",label:"Date Range",children:s.jsxs(X,{"data-loc":"client/src/pages/Estimates.tsx:420",value:u,onValueChange:L,children:[s.jsx(Y,{"data-loc":"client/src/pages/Estimates.tsx:421",children:s.jsx(J,{"data-loc":"client/src/pages/Estimates.tsx:422",placeholder:"All Time"})}),s.jsxs(Z,{"data-loc":"client/src/pages/Estimates.tsx:424",children:[s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:425",value:"all",children:"All Time"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:426",value:"today",children:"Today"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:427",value:"7days",children:"Last 7 Days"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:428",value:"30days",children:"Last 30 Days"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:429",value:"90days",children:"Last 90 Days"}),s.jsx(l,{"data-loc":"client/src/pages/Estimates.tsx:430",value:"year",children:"Last Year"})]})]})})]})}),s.jsxs(ws,{"data-loc":"client/src/pages/Estimates.tsx:438",children:[s.jsxs(Ds,{"data-loc":"client/src/pages/Estimates.tsx:439",children:[s.jsx(ys,{"data-loc":"client/src/pages/Estimates.tsx:440",children:"All Estimates"}),s.jsxs(Cs,{"data-loc":"client/src/pages/Estimates.tsx:441",children:[s.jsx("span",{"data-loc":"client/src/pages/Estimates.tsx:442",className:"font-numeric",children:v.length})," ","estimate",v.length!==1?"s":""," found"]})]}),s.jsx(Ts,{"data-loc":"client/src/pages/Estimates.tsx:448",children:ms?s.jsx(Vs,{"data-loc":"client/src/pages/Estimates.tsx:450"}):!j||j.length===0?s.jsx(Q,{"data-loc":"client/src/pages/Estimates.tsx:452",...W.estimates,action:{label:"Create Estimate",onClick:()=>m("/estimates/create"),icon:es}}):v.length===0?s.jsx(Q,{"data-loc":"client/src/pages/Estimates.tsx:461",...W.search,size:"sm"}):s.jsxs(s.Fragment,{children:[s.jsx(Us,{"data-loc":"client/src/pages/Estimates.tsx:465",minWidth:850,className:"hidden md:block",children:s.jsxs(As,{"data-loc":"client/src/pages/Estimates.tsx:466",children:[s.jsx(Is,{"data-loc":"client/src/pages/Estimates.tsx:467",children:s.jsxs(q,{"data-loc":"client/src/pages/Estimates.tsx:468",children:[s.jsx(b,{"data-loc":"client/src/pages/Estimates.tsx:469",label:"Estimate #",sortKey:"estimateNumber",currentSort:E,onSort:h}),s.jsx(b,{"data-loc":"client/src/pages/Estimates.tsx:475",label:"Client",sortKey:"clientName",currentSort:E,onSort:h}),s.jsx(H,{"data-loc":"client/src/pages/Estimates.tsx:481",children:"Title"}),s.jsx(b,{"data-loc":"client/src/pages/Estimates.tsx:482",label:"Status",sortKey:"status",currentSort:E,onSort:h}),s.jsx(b,{"data-loc":"client/src/pages/Estimates.tsx:488",label:"Valid Until",sortKey:"validUntil",currentSort:E,onSort:h}),s.jsx(b,{"data-loc":"client/src/pages/Estimates.tsx:494",label:"Amount",sortKey:"total",currentSort:E,onSort:h,align:"right"}),s.jsx(H,{"data-loc":"client/src/pages/Estimates.tsx:501",className:"w-[50px]"})]})}),s.jsx(Ms,{"data-loc":"client/src/pages/Estimates.tsx:504",children:$.map(e=>s.jsxs(q,{"data-loc":"client/src/pages/Estimates.tsx:506",children:[s.jsx(d,{"data-loc":"client/src/pages/Estimates.tsx:507",className:"font-medium",children:s.jsx(C,{"data-loc":"client/src/pages/Estimates.tsx:508",href:`/estimates/${e.id}`,children:s.jsx("span",{"data-loc":"client/src/pages/Estimates.tsx:509",className:"text-primary hover:underline cursor-pointer",children:e.estimateNumber})})}),s.jsx(d,{"data-loc":"client/src/pages/Estimates.tsx:514",children:e.clientName||"—"}),s.jsx(d,{"data-loc":"client/src/pages/Estimates.tsx:515",children:e.title||"—"}),s.jsx(d,{"data-loc":"client/src/pages/Estimates.tsx:516",children:B(e.status)}),s.jsx(d,{"data-loc":"client/src/pages/Estimates.tsx:519",children:K(e.validUntil)}),s.jsx(d,{"data-loc":"client/src/pages/Estimates.tsx:522",className:"text-right font-numeric",children:O(Number(e.total),e.currency)}),s.jsx(d,{"data-loc":"client/src/pages/Estimates.tsx:528",children:s.jsxs(Ps,{"data-loc":"client/src/pages/Estimates.tsx:529",children:[s.jsx(Rs,{"data-loc":"client/src/pages/Estimates.tsx:530",asChild:!0,children:s.jsx(f,{"data-loc":"client/src/pages/Estimates.tsx:531",variant:"ghost",size:"icon","aria-label":"More actions for this estimate",children:s.jsx(Os,{"data-loc":"client/src/pages/Estimates.tsx:536",className:"h-4 w-4"})})}),s.jsxs(zs,{"data-loc":"client/src/pages/Estimates.tsx:539",align:"end",children:[s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:540",onClick:()=>m(`/estimates/${e.id}`),children:[s.jsx(T,{"data-loc":"client/src/pages/Estimates.tsx:545",className:"h-4 w-4 mr-2"}),"View"]}),e.status==="draft"&&s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:549",onClick:()=>m(`/estimates/${e.id}/edit`),children:[s.jsx(qs,{"data-loc":"client/src/pages/Estimates.tsx:556",className:"h-4 w-4 mr-2"}),"Edit"]}),s.jsx(G,{"data-loc":"client/src/pages/Estimates.tsx:560"}),e.status==="draft"&&s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:562",onClick:()=>us.mutate({id:e.id}),children:[s.jsx(cs,{"data-loc":"client/src/pages/Estimates.tsx:567",className:"h-4 w-4 mr-2"}),"Mark as Sent"]}),(e.status==="sent"||e.status==="viewed")&&s.jsxs(s.Fragment,{children:[s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:574",onClick:()=>gs.mutate({id:e.id}),children:[s.jsx(is,{"data-loc":"client/src/pages/Estimates.tsx:581",className:"h-4 w-4 mr-2"}),"Mark as Accepted"]}),s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:584",onClick:()=>Es.mutate({id:e.id}),children:[s.jsx(ls,{"data-loc":"client/src/pages/Estimates.tsx:591",className:"h-4 w-4 mr-2"}),"Mark as Rejected"]})]}),(e.status==="accepted"||e.status==="sent"||e.status==="viewed")&&!e.convertedToInvoiceId&&s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:600",onClick:()=>z.mutate({id:e.id}),className:"text-primary",children:[s.jsx(k,{"data-loc":"client/src/pages/Estimates.tsx:608",className:"h-4 w-4 mr-2"}),"Convert to Invoice"]}),e.convertedToInvoiceId&&s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:613",onClick:()=>m(`/invoices/${e.convertedToInvoiceId}`),children:[s.jsx(rs,{"data-loc":"client/src/pages/Estimates.tsx:620",className:"h-4 w-4 mr-2"}),"View Invoice"]}),s.jsx(G,{"data-loc":"client/src/pages/Estimates.tsx:624"}),s.jsxs(n,{"data-loc":"client/src/pages/Estimates.tsx:625",onClick:()=>_(e),className:"text-destructive",children:[s.jsx(ts,{"data-loc":"client/src/pages/Estimates.tsx:629",className:"h-4 w-4 mr-2"}),"Delete"]})]})]})})]},e.id))})]})}),s.jsx("div",{"data-loc":"client/src/pages/Estimates.tsx:642",className:"md:hidden space-y-4",children:$.map(e=>s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:644",className:"p-4 border rounded-lg space-y-3",children:[s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:648",className:"flex items-start justify-between",children:[s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:649",children:[s.jsx(C,{"data-loc":"client/src/pages/Estimates.tsx:650",href:`/estimates/${e.id}`,children:s.jsx("span",{"data-loc":"client/src/pages/Estimates.tsx:651",className:"font-medium text-primary hover:underline cursor-pointer",children:e.estimateNumber})}),s.jsx("p",{"data-loc":"client/src/pages/Estimates.tsx:655",className:"text-sm text-muted-foreground",children:e.clientName})]}),B(e.status)]}),e.title&&s.jsx("p",{"data-loc":"client/src/pages/Estimates.tsx:662",className:"text-sm",children:e.title}),s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:664",className:"flex items-center justify-between text-sm",children:[s.jsxs("span",{"data-loc":"client/src/pages/Estimates.tsx:665",className:"text-muted-foreground",children:["Valid until ",K(e.validUntil)]}),s.jsx("span",{"data-loc":"client/src/pages/Estimates.tsx:668",className:"font-numeric",children:O(Number(e.total),e.currency)})]}),s.jsxs("div",{"data-loc":"client/src/pages/Estimates.tsx:675",className:"flex gap-2 pt-2 border-t",children:[s.jsxs(f,{"data-loc":"client/src/pages/Estimates.tsx:676",variant:"outline",size:"sm",onClick:()=>m(`/estimates/${e.id}`),className:"flex-1",children:[s.jsx(T,{"data-loc":"client/src/pages/Estimates.tsx:684",className:"h-4 w-4 mr-1"}),"View"]}),!e.convertedToInvoiceId&&(e.status==="accepted"||e.status==="sent"||e.status==="viewed")&&s.jsxs(f,{"data-loc":"client/src/pages/Estimates.tsx:691",variant:"outline",size:"sm",onClick:()=>z.mutate({id:e.id}),className:"flex-1 text-primary",children:[s.jsx(k,{"data-loc":"client/src/pages/Estimates.tsx:699",className:"h-4 w-4 mr-1"}),"Convert"]}),s.jsx(f,{"data-loc":"client/src/pages/Estimates.tsx:703",variant:"outline",size:"sm",onClick:()=>_(e),className:"text-destructive hover:text-destructive",children:s.jsx(ts,{"data-loc":"client/src/pages/Estimates.tsx:709",className:"h-4 w-4"})})]})]},e.id))}),U>1&&s.jsx("div",{"data-loc":"client/src/pages/Estimates.tsx:718",className:"mt-6 pt-4 border-t border-border/20",children:s.jsx($s,{"data-loc":"client/src/pages/Estimates.tsx:719",currentPage:y,totalPages:U,pageSize:N,totalItems:V,onPageChange:S,onPageSizeChange:e=>{ds(e),S(1)},pageSizeOptions:[10,25,50,100]})})]})})]})]}),s.jsx(Ls,{"data-loc":"client/src/pages/Estimates.tsx:739",open:os,onOpenChange:w,onConfirm:vs,title:"Delete Estimate",description:`Are you sure you want to delete estimate ${D?.estimateNumber}? This action cannot be undone.`,isLoading:R.isPending})]})}export{me as default};
