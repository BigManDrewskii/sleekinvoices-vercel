import{r as G,j as e}from"./vendor-react-BuVtq312.js";import{b as X,u as _,y as J,t as l,k as n,g as K,L as g,B as i,C as u,z as w,A as h,a as j,m as T,j as W}from"./index-hzFfJlKH.js";import{T as Y,a as Z,b as A,c as d,d as ee,e as o}from"./table-y7wtTQEZ.js";import{D as te}from"./DeleteConfirmDialog-BLT6kY2H.js";import{C as r}from"./typography-CdqW54LS.js";import{N as I}from"./Navigation-DKoTJDrW.js";import{V as se}from"./PageSkeletons-DirSuB2s.js";import{z as D,a0 as ae,an as z,aq as L,aD as R,A as B,d as M,a2 as ie,l as ce,ac as le}from"./vendor-icons-CPPAmKDz.js";import"./vendor-data-DopHG4T0.js";import"./vendor-radix-DQBG9U-J.js";import"./alert-dialog-nKHsLnMc.js";import"./vendor-date-B2OJh1lx.js";import"./UserAvatar-DzPpP9tb.js";import"./skeleton-QN8DVCY2.js";import"./PageLayout-D7c6YbGr.js";const S={draft:{label:"Draft",variant:"secondary",icon:M},sent:{label:"Sent",variant:"default",icon:z},viewed:{label:"Viewed",variant:"outline",icon:le},accepted:{label:"Accepted",variant:"default",icon:L},rejected:{label:"Rejected",variant:"destructive",icon:R},expired:{label:"Expired",variant:"secondary",icon:ce},converted:{label:"Converted",variant:"default",icon:B}};function Ne(){const{loading:P,isAuthenticated:E}=X(),[,m]=_(),F=J(),a=parseInt(F.id||"0"),[U,V]=G.useState(!1),{data:v,isLoading:$,error:O}=l.estimates.get.useQuery({id:a},{enabled:E&&a>0}),x=l.useUtils(),N=l.estimates.delete.useMutation({onSuccess:()=>{n.success("Estimate deleted successfully"),m("/estimates")},onError:s=>{n.error(s.message||"Failed to delete estimate")}}),f=l.estimates.convertToInvoice.useMutation({onSuccess:s=>{n.success(`Converted to invoice ${s.invoiceNumber}`),m(`/invoices/${s.invoiceId}`)},onError:s=>{n.error(s.message||"Failed to convert estimate")}}),b=l.estimates.markAsSent.useMutation({onSuccess:()=>{n.success("Estimate marked as sent"),x.estimates.get.invalidate({id:a})}}),y=l.estimates.markAsAccepted.useMutation({onSuccess:()=>{n.success("Estimate marked as accepted"),x.estimates.get.invalidate({id:a})}}),k=l.estimates.markAsRejected.useMutation({onSuccess:()=>{n.success("Estimate marked as rejected"),x.estimates.get.invalidate({id:a})}});if(P||$)return e.jsx(se,{"data-loc":"client/src/pages/ViewEstimate.tsx:110"});if(!E)return window.location.href=K(),null;if(O||!v)return e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:120",className:"min-h-screen bg-background",children:[e.jsx(I,{"data-loc":"client/src/pages/ViewEstimate.tsx:121"}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:122",className:"container mx-auto px-4 md:px-6 py-12 md:py-16 text-center",children:[e.jsx("h1",{"data-loc":"client/src/pages/ViewEstimate.tsx:123",className:"text-2xl font-bold text-foreground mb-4",children:"Estimate Not Found"}),e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:126",className:"text-muted-foreground mb-8",children:"The estimate you're looking for doesn't exist or you don't have permission to view it."}),e.jsx(g,{"data-loc":"client/src/pages/ViewEstimate.tsx:130",href:"/estimates",children:e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:131",children:[e.jsx(D,{"data-loc":"client/src/pages/ViewEstimate.tsx:132",className:"h-4 w-4 mr-2"}),"Back to Estimates"]})})]})]});const{estimate:t,lineItems:q,client:c}=v,H=s=>{const p=S[s]||S.draft,Q=p.icon;return e.jsxs(W,{"data-loc":"client/src/pages/ViewEstimate.tsx:147",variant:p.variant,className:"flex items-center gap-1 w-fit",children:[e.jsx(Q,{"data-loc":"client/src/pages/ViewEstimate.tsx:148",className:"h-3 w-3"}),p.label]})},C=new Date(t.validUntil)<new Date&&!["accepted","rejected","converted","expired"].includes(t.status);return e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:159",className:"min-h-screen bg-background",children:[e.jsx(I,{"data-loc":"client/src/pages/ViewEstimate.tsx:160"}),e.jsx("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:162",className:"container mx-auto px-4 py-8",children:e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:163",className:"max-w-4xl mx-auto",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:165",className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:166",className:"flex items-center gap-4",children:[e.jsx(g,{"data-loc":"client/src/pages/ViewEstimate.tsx:167",href:"/estimates",children:e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:168",variant:"ghost",size:"sm",children:[e.jsx(D,{"data-loc":"client/src/pages/ViewEstimate.tsx:169",className:"h-4 w-4 mr-2"}),"Back"]})}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:173",children:[e.jsx("h1",{"data-loc":"client/src/pages/ViewEstimate.tsx:174",className:"text-3xl font-bold text-foreground",children:t.estimateNumber}),e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:177",className:"text-muted-foreground",children:t.title||"Estimate Details"})]})]}),H(t.status)]}),C&&e.jsx("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:187",className:"mb-6 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:188",className:"text-yellow-600 dark:text-yellow-400",children:"This estimate has expired. Consider creating a new one or extending the validity date."})}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:196",className:"flex flex-wrap items-center gap-2 mb-6",children:[t.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:199",variant:"outline",size:"sm",onClick:()=>m(`/estimates/${a}/edit`),children:[e.jsx(ae,{"data-loc":"client/src/pages/ViewEstimate.tsx:204",className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:207",variant:"outline",size:"sm",onClick:()=>b.mutate({id:a}),disabled:b.isPending,children:[e.jsx(z,{"data-loc":"client/src/pages/ViewEstimate.tsx:213",className:"h-4 w-4 mr-2"}),"Mark as Sent"]})]}),(t.status==="sent"||t.status==="viewed")&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:221",variant:"outline",size:"sm",onClick:()=>y.mutate({id:a}),disabled:y.isPending,className:"text-green-600",children:[e.jsx(L,{"data-loc":"client/src/pages/ViewEstimate.tsx:228",className:"h-4 w-4 mr-2"}),"Mark as Accepted"]}),e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:231",variant:"outline",size:"sm",onClick:()=>k.mutate({id:a}),disabled:k.isPending,className:"text-destructive",children:[e.jsx(R,{"data-loc":"client/src/pages/ViewEstimate.tsx:238",className:"h-4 w-4 mr-2"}),"Mark as Rejected"]})]}),!t.convertedToInvoiceId&&(t.status==="accepted"||t.status==="sent"||t.status==="viewed")&&e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:248",size:"sm",onClick:()=>f.mutate({id:a}),disabled:f.isPending,children:[e.jsx(B,{"data-loc":"client/src/pages/ViewEstimate.tsx:253",className:"h-4 w-4 mr-2"}),"Convert to Invoice"]}),t.convertedToInvoiceId&&e.jsx(g,{"data-loc":"client/src/pages/ViewEstimate.tsx:259",href:`/invoices/${t.convertedToInvoiceId}`,children:e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:260",variant:"outline",size:"sm",children:[e.jsx(M,{"data-loc":"client/src/pages/ViewEstimate.tsx:261",className:"h-4 w-4 mr-2"}),"View Invoice"]})}),e.jsxs(i,{"data-loc":"client/src/pages/ViewEstimate.tsx:267",variant:"outline",size:"sm",onClick:()=>V(!0),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(ie,{"data-loc":"client/src/pages/ViewEstimate.tsx:273",className:"h-4 w-4 mr-2"}),"Delete"]})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:279",className:"space-y-6",children:[e.jsxs(u,{"data-loc":"client/src/pages/ViewEstimate.tsx:281",children:[e.jsx(w,{"data-loc":"client/src/pages/ViewEstimate.tsx:282",children:e.jsx(h,{"data-loc":"client/src/pages/ViewEstimate.tsx:283",children:"Estimate Information"})}),e.jsx(j,{"data-loc":"client/src/pages/ViewEstimate.tsx:285",children:e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:286",className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:287",children:[e.jsx("h3",{"data-loc":"client/src/pages/ViewEstimate.tsx:288",className:"font-semibold text-foreground mb-2",children:"Client"}),e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:291",className:"text-foreground",children:c?.name||"Unknown"}),c?.companyName&&e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:295",className:"text-muted-foreground",children:c.companyName}),c?.email&&e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:300",className:"text-muted-foreground",children:c.email}),c?.address&&e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:303",className:"text-muted-foreground whitespace-pre-line",children:c.address})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:308",className:"space-y-2",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:309",className:"flex justify-between",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:310",className:"text-muted-foreground",children:"Issue Date"}),e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:311",className:"font-medium",children:T(t.issueDate)})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:315",className:"flex justify-between",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:316",className:"text-muted-foreground",children:"Valid Until"}),e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:317",className:`font-medium ${C?"text-destructive":""}`,children:T(t.validUntil)})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:323",className:"flex justify-between",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:324",className:"text-muted-foreground",children:"Currency"}),e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:325",className:"font-medium",children:t.currency})]})]})]})})]}),e.jsxs(u,{"data-loc":"client/src/pages/ViewEstimate.tsx:333",children:[e.jsx(w,{"data-loc":"client/src/pages/ViewEstimate.tsx:334",children:e.jsx(h,{"data-loc":"client/src/pages/ViewEstimate.tsx:335",children:"Line Items"})}),e.jsxs(j,{"data-loc":"client/src/pages/ViewEstimate.tsx:337",children:[e.jsxs(Y,{"data-loc":"client/src/pages/ViewEstimate.tsx:338",children:[e.jsx(Z,{"data-loc":"client/src/pages/ViewEstimate.tsx:339",children:e.jsxs(A,{"data-loc":"client/src/pages/ViewEstimate.tsx:340",children:[e.jsx(d,{"data-loc":"client/src/pages/ViewEstimate.tsx:341",children:"Description"}),e.jsx(d,{"data-loc":"client/src/pages/ViewEstimate.tsx:342",className:"text-right",children:"Qty"}),e.jsx(d,{"data-loc":"client/src/pages/ViewEstimate.tsx:343",className:"text-right",children:"Rate"}),e.jsx(d,{"data-loc":"client/src/pages/ViewEstimate.tsx:344",className:"text-right",children:"Amount"})]})}),e.jsx(ee,{"data-loc":"client/src/pages/ViewEstimate.tsx:347",children:q.map(s=>e.jsxs(A,{"data-loc":"client/src/pages/ViewEstimate.tsx:349",children:[e.jsx(o,{"data-loc":"client/src/pages/ViewEstimate.tsx:350",children:s.description}),e.jsx(o,{"data-loc":"client/src/pages/ViewEstimate.tsx:351",className:"text-right",children:s.quantity}),e.jsx(o,{"data-loc":"client/src/pages/ViewEstimate.tsx:354",className:"text-right",children:e.jsx(r,{"data-loc":"client/src/pages/ViewEstimate.tsx:355",amount:Number(s.rate),currency:t.currency})}),e.jsx(o,{"data-loc":"client/src/pages/ViewEstimate.tsx:360",className:"text-right",children:e.jsx(r,{"data-loc":"client/src/pages/ViewEstimate.tsx:361",amount:Number(s.amount),currency:t.currency,bold:!0})})]},s.id))})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:373",className:"mt-6 space-y-2 border-t pt-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:374",className:"flex justify-between",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:375",className:"text-muted-foreground",children:"Subtotal"}),e.jsx(r,{"data-loc":"client/src/pages/ViewEstimate.tsx:376",amount:Number(t.subtotal),currency:t.currency})]}),Number(t.discountAmount)>0&&e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:382",className:"flex justify-between text-destructive",children:[e.jsxs("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:383",children:["Discount",t.discountType==="percentage"&&` (${t.discountValue}%)`]}),e.jsxs("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:388",children:["-",e.jsx(r,{"data-loc":"client/src/pages/ViewEstimate.tsx:390",amount:Number(t.discountAmount),currency:t.currency})]})]}),Number(t.taxAmount)>0&&e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:398",className:"flex justify-between",children:[e.jsxs("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:399",className:"text-muted-foreground",children:["Tax (",t.taxRate,"%)"]}),e.jsx(r,{"data-loc":"client/src/pages/ViewEstimate.tsx:402",amount:Number(t.taxAmount),currency:t.currency})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:408",className:"flex justify-between text-lg pt-2 border-t",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewEstimate.tsx:409",className:"font-bold",children:"Total"}),e.jsx(r,{"data-loc":"client/src/pages/ViewEstimate.tsx:410",amount:Number(t.total),currency:t.currency,bold:!0})]})]})]})]}),(t.notes||t.terms)&&e.jsxs(u,{"data-loc":"client/src/pages/ViewEstimate.tsx:422",children:[e.jsx(w,{"data-loc":"client/src/pages/ViewEstimate.tsx:423",children:e.jsx(h,{"data-loc":"client/src/pages/ViewEstimate.tsx:424",children:"Notes & Terms"})}),e.jsxs(j,{"data-loc":"client/src/pages/ViewEstimate.tsx:426",className:"space-y-4",children:[t.notes&&e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:428",children:[e.jsx("h4",{"data-loc":"client/src/pages/ViewEstimate.tsx:429",className:"font-medium text-foreground mb-1",children:"Notes"}),e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:432",className:"text-muted-foreground whitespace-pre-line",children:t.notes})]}),t.terms&&e.jsxs("div",{"data-loc":"client/src/pages/ViewEstimate.tsx:438",children:[e.jsx("h4",{"data-loc":"client/src/pages/ViewEstimate.tsx:439",className:"font-medium text-foreground mb-1",children:"Terms & Conditions"}),e.jsx("p",{"data-loc":"client/src/pages/ViewEstimate.tsx:442",className:"text-muted-foreground whitespace-pre-line",children:t.terms})]})]})]})]})]})}),e.jsx(te,{"data-loc":"client/src/pages/ViewEstimate.tsx:455",open:U,onOpenChange:V,onConfirm:()=>N.mutate({id:a}),title:"Delete Estimate",description:`Are you sure you want to delete estimate ${t.estimateNumber}? This action cannot be undone.`,isLoading:N.isPending})]})}export{Ne as default};
