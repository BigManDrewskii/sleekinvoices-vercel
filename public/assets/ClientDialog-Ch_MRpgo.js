import{r as n,j as e}from"./vendor-react-BuVtq312.js";import{t as f,k as m,D as J,e as R,f as X,h as Z,O as G,i as K,l as Q,I as N,B as W,n as Y}from"./index-hzFfJlKH.js";import{L as x}from"./label-DJDGx5UM.js";import{T as O}from"./textarea-CA7ezKjn.js";import{C as ee}from"./checkbox-Cacebbmr.js";import{k as te,aB as se,I as ae,a3 as le,a4 as ne,_ as ie,d as ce,L as B,X as oe,m as re}from"./vendor-icons-CPPAmKDz.js";function he({open:w,onOpenChange:u,client:s,onSuccess:F}){const[g,h]=n.useState(""),[v,j]=n.useState(""),[I,b]=n.useState(""),[y,C]=n.useState(""),[p,E]=n.useState(""),[M,V]=n.useState(!1),[S,r]=n.useState("idle"),[P,d]=n.useState(""),[D,k]=n.useState({}),a=f.useUtils(),T=f.clients.validateVAT.useMutation({onSuccess:t=>{t.valid?(r("valid"),d(`Valid VAT number${t.name?` - ${t.name}`:""}`),t.name&&!g.trim()&&(h(t.name),m.success("Company name auto-filled from VAT registry")),t.address&&!y.trim()&&C(t.address)):(r("invalid"),d(t.errorMessage||"Invalid VAT number"))},onError:t=>{r("invalid"),d(t.message||"Validation failed")}}),z=f.clients.create.useMutation({onMutate:async t=>{await a.clients.list.cancel();const c=a.clients.list.getData(),l={id:-Date.now(),name:t.name,email:t.email||null,phone:t.phone||null,address:t.address||null,companyName:null,notes:null,vatNumber:t.vatNumber||null,taxExempt:t.taxExempt??!1,createdAt:new Date,updatedAt:new Date,userId:0};return a.clients.list.setData(void 0,o=>o?[l,...o]:[l]),u(!1),A(),{previousClients:c}},onSuccess:t=>{m.success("Client created successfully"),F?.(t.id)},onError:(t,c,l)=>{l?.previousClients&&a.clients.list.setData(void 0,l.previousClients),m.error(t.message||"Failed to create client")},onSettled:()=>{a.clients.list.invalidate()}}),U=f.clients.update.useMutation({onMutate:async t=>{await a.clients.list.cancel();const c=a.clients.list.getData();return a.clients.list.setData(void 0,l=>l?.map(o=>o.id===t.id?{...o,name:t.name||o.name,email:t.email||null,phone:t.phone||null,address:t.address||null,vatNumber:t.vatNumber||null,taxExempt:t.taxExempt??o.taxExempt,updatedAt:new Date}:o)),u(!1),A(),{previousClients:c}},onSuccess:()=>{m.success("Client updated successfully"),F?.()},onError:(t,c,l)=>{l?.previousClients&&a.clients.list.setData(void 0,l.previousClients),m.error(t.message||"Failed to update client")},onSettled:()=>{a.clients.list.invalidate()}});n.useEffect(()=>{s?(h(s.name),j(s.email||""),b(s.phone||""),C(s.address||""),E(s.vatNumber||""),V(s.taxExempt||!1),r("idle"),d("")):A()},[s,w]);const A=()=>{h(""),j(""),b(""),C(""),E(""),V(!1),r("idle"),d(""),k({})},L=()=>{const t={};return g.trim()||(t.name="Name is required"),v&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)&&(t.email="Invalid email format"),k(t),Object.keys(t).length===0},$=()=>{if(!p.trim()){m.error("Please enter a VAT number to validate");return}r("validating"),d(""),T.mutate({vatNumber:p.trim()})},_=t=>{E(t),S!=="idle"&&(r("idle"),d(""))},H=t=>{if(t.preventDefault(),!L())return;const c={name:g.trim(),email:v.trim()||void 0,phone:I.trim()||void 0,address:y.trim()||void 0,vatNumber:p.trim()||void 0,taxExempt:M};s?U.mutate({id:s.id,...c}):z.mutate(c)},i=z.isPending||U.isPending,q=()=>{switch(S){case"validating":return e.jsx(B,{"data-loc":"client/src/components/clients/ClientDialog.tsx:298",className:"h-4 w-4 animate-spin text-muted-foreground"});case"valid":return e.jsx(re,{"data-loc":"client/src/components/clients/ClientDialog.tsx:301",className:"h-4 w-4 text-green-500"});case"invalid":return e.jsx(oe,{"data-loc":"client/src/components/clients/ClientDialog.tsx:303",className:"h-4 w-4 text-destructive"});default:return null}};return e.jsx(J,{"data-loc":"client/src/components/clients/ClientDialog.tsx:310",open:w,onOpenChange:u,children:e.jsx(R,{"data-loc":"client/src/components/clients/ClientDialog.tsx:311",className:"sm:max-w-[500px]",children:e.jsxs("form",{"data-loc":"client/src/components/clients/ClientDialog.tsx:312",onSubmit:H,children:[e.jsxs(X,{"data-loc":"client/src/components/clients/ClientDialog.tsx:313",children:[e.jsx(Z,{"data-loc":"client/src/components/clients/ClientDialog.tsx:314",children:e.jsx(G,{"data-loc":"client/src/components/clients/ClientDialog.tsx:315",icon:te,title:s?"Edit Client":"Add New Client",variant:"primary",size:"sm"})}),e.jsx(K,{"data-loc":"client/src/components/clients/ClientDialog.tsx:322",children:s?"Update client information":"Add a new client to your database"})]}),e.jsxs(Q,{"data-loc":"client/src/components/clients/ClientDialog.tsx:329",spacing:"relaxed",children:[e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:331",className:"space-y-4",children:[e.jsx("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:332",className:"space-y-1",children:e.jsx("h3",{"data-loc":"client/src/components/clients/ClientDialog.tsx:333",className:"text-sm font-medium text-foreground",children:"Contact Information"})}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:338",className:"grid gap-4",children:[e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:339",className:"space-y-2",children:[e.jsxs(x,{"data-loc":"client/src/components/clients/ClientDialog.tsx:340",htmlFor:"name",className:"text-sm font-medium",children:["Name ",e.jsx("span",{"data-loc":"client/src/components/clients/ClientDialog.tsx:341",className:"text-destructive",children:"*"})]}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:343",className:"relative",children:[e.jsx(se,{"data-loc":"client/src/components/clients/ClientDialog.tsx:344",className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx(N,{"data-loc":"client/src/components/clients/ClientDialog.tsx:345",id:"name",value:g,onChange:t=>h(t.target.value),placeholder:"John Doe or Company Name",disabled:i,className:"pl-9"})]}),D.name&&e.jsx("p",{"data-loc":"client/src/components/clients/ClientDialog.tsx:355",className:"text-sm text-destructive",children:D.name})]}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:359",className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:360",className:"space-y-2",children:[e.jsx(x,{"data-loc":"client/src/components/clients/ClientDialog.tsx:361",htmlFor:"email",className:"text-sm font-medium",children:"Email"}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:364",className:"relative",children:[e.jsx(ae,{"data-loc":"client/src/components/clients/ClientDialog.tsx:365",className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx(N,{"data-loc":"client/src/components/clients/ClientDialog.tsx:366",id:"email",type:"email",value:v,onChange:t=>j(t.target.value),placeholder:"john@example.com",disabled:i,className:"pl-9"})]}),D.email&&e.jsx("p",{"data-loc":"client/src/components/clients/ClientDialog.tsx:377",className:"text-sm text-destructive",children:D.email})]}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:381",className:"space-y-2",children:[e.jsx(x,{"data-loc":"client/src/components/clients/ClientDialog.tsx:382",htmlFor:"phone",className:"text-sm font-medium",children:"Phone"}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:385",className:"relative",children:[e.jsx(le,{"data-loc":"client/src/components/clients/ClientDialog.tsx:386",className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx(N,{"data-loc":"client/src/components/clients/ClientDialog.tsx:387",id:"phone",value:I,onChange:t=>b(t.target.value),placeholder:"+1 (555) 123-4567",disabled:i,className:"pl-9"})]})]})]}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:399",className:"space-y-2",children:[e.jsx(x,{"data-loc":"client/src/components/clients/ClientDialog.tsx:400",htmlFor:"address",className:"text-sm font-medium",children:"Address"}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:403",className:"relative",children:[e.jsx(ne,{"data-loc":"client/src/components/clients/ClientDialog.tsx:404",className:"absolute left-3 top-3 size-4 text-muted-foreground"}),e.jsx(O,{"data-loc":"client/src/components/clients/ClientDialog.tsx:405",id:"address",value:y,onChange:t=>C(t.target.value),placeholder:"123 Main St, City, State, ZIP",rows:2,disabled:i,className:"pl-9 resize-none"})]})]})]})]}),e.jsx("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:419",className:"h-px bg-border"}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:422",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:423",className:"flex items-center gap-2",children:[e.jsx(ie,{"data-loc":"client/src/components/clients/ClientDialog.tsx:424",className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{"data-loc":"client/src/components/clients/ClientDialog.tsx:425",className:"text-sm font-medium text-foreground",children:"Tax Information"})]}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:430",className:"grid gap-4",children:[e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:431",className:"space-y-2",children:[e.jsx(x,{"data-loc":"client/src/components/clients/ClientDialog.tsx:432",htmlFor:"vatNumber",className:"text-sm font-medium",children:"VAT / Tax ID"}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:435",className:"flex gap-2",children:[e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:436",className:"relative flex-1",children:[e.jsx(ce,{"data-loc":"client/src/components/clients/ClientDialog.tsx:437",className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-muted-foreground"}),e.jsx(N,{"data-loc":"client/src/components/clients/ClientDialog.tsx:438",id:"vatNumber",value:p,onChange:t=>_(t.target.value.toUpperCase()),placeholder:"e.g., DE123456789",disabled:i,className:"pl-9 pr-8"}),e.jsx("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:448",className:"absolute right-2 top-1/2 -translate-y-1/2",children:q()})]}),e.jsx(W,{"data-loc":"client/src/components/clients/ClientDialog.tsx:452",type:"button",variant:"outline",size:"sm",onClick:$,disabled:i||T.isPending||!p.trim(),className:"whitespace-nowrap",children:T.isPending?e.jsxs(e.Fragment,{children:[e.jsx(B,{"data-loc":"client/src/components/clients/ClientDialog.tsx:464",className:"h-4 w-4 animate-spin"}),"Validating"]}):"Validate VAT"})]}),P&&e.jsx("p",{"data-loc":"client/src/components/clients/ClientDialog.tsx:473",className:`text-sm ${S==="valid"?"text-green-600":"text-destructive"}`,children:P}),e.jsx("p",{"data-loc":"client/src/components/clients/ClientDialog.tsx:479",className:"text-xs text-muted-foreground",children:"For EU clients, enter the full VAT number including country code"})]}),e.jsxs("div",{"data-loc":"client/src/components/clients/ClientDialog.tsx:485",className:"flex items-center space-x-2",children:[e.jsx(ee,{"data-loc":"client/src/components/clients/ClientDialog.tsx:486",id:"taxExempt",checked:M,onCheckedChange:t=>V(t===!0),disabled:i}),e.jsx(x,{"data-loc":"client/src/components/clients/ClientDialog.tsx:492",htmlFor:"taxExempt",className:"text-sm font-normal cursor-pointer",children:"Tax Exempt"})]}),e.jsx("p",{"data-loc":"client/src/components/clients/ClientDialog.tsx:499",className:"text-xs text-muted-foreground -mt-2 ml-6",children:"Check this if the client is exempt from tax (e.g., reverse charge for B2B EU transactions)"})]})]})]}),e.jsx(Y,{"data-loc":"client/src/components/clients/ClientDialog.tsx:507",onClose:()=>u(!1),onSubmit:()=>{},submitText:s?"Update Client":"Create Client",cancelText:"Cancel",isLoading:i})]})})})}export{he as C};
