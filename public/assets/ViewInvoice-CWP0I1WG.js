import{r as g,j as e}from"./vendor-react-BuVtq312.js";import{t as y,k as c,D as G,e as J,f as K,h as Z,i as ee,v as W,l as te,B as o,n as ae,O as ve,I as T,b as je,u as Pe,y as we,P as ie,g as fe,L as Q,S as me,j as Ne,C as A,z as L,A as z,a as E,E as Ie,m as De}from"./index-hzFfJlKH.js";import{T as Ve,a as be,b as oe,c as H,d as Ce,e as R}from"./table-y7wtTQEZ.js";import{D as ke}from"./DeleteConfirmDialog-BLT6kY2H.js";import{D as $,C as P}from"./typography-CdqW54LS.js";import{L as N}from"./label-DJDGx5UM.js";import{S as pe,a as xe,b as ye,c as ge,d as O}from"./select-BmfPitD4.js";import{T as ue}from"./textarea-CA7ezKjn.js";import{N as Se}from"./Navigation-DKoTJDrW.js";import{B as X,x as Fe,u as Te,L as he,m as le,E as Me,y as Ae,f as Y,O as Le,D as se,ap as ze,d as Ee,z as re,a0 as Oe,a7 as Be,I as de,s as Ue,aq as He,a2 as Re,ac as $e}from"./vendor-icons-CPPAmKDz.js";import{A as _e,a as We}from"./alert-BRTSJszf.js";import{P as Qe}from"./progress-DJbV8nE5.js";import{f as q}from"./vendor-date-B2OJh1lx.js";import{V as Ye}from"./PageSkeletons-DirSuB2s.js";import"./vendor-data-DopHG4T0.js";import"./vendor-radix-DQBG9U-J.js";import"./alert-dialog-nKHsLnMc.js";import"./UserAvatar-DzPpP9tb.js";import"./skeleton-QN8DVCY2.js";import"./PageLayout-D7c6YbGr.js";function qe({open:w,onOpenChange:I,invoiceId:l,amount:x,currency:s,onPaymentCreated:r}){const[d,m]=g.useState(null),[h,u]=g.useState(!1),v=y.crypto.createPayment.useMutation({onSuccess:p=>{m(p.invoiceUrl),c.success("Payment link created! Choose your preferred cryptocurrency on the checkout page."),r?.()},onError:p=>{c.error(p.message||"Failed to create crypto payment")}});g.useEffect(()=>{w||(m(null),u(!1))},[w]);const D=()=>{v.mutate({invoiceId:l})},n=()=>{d&&(navigator.clipboard.writeText(d),u(!0),c.success("Payment link copied to clipboard"),setTimeout(()=>u(!1),2e3))},V=()=>{d&&window.open(d,"_blank")};return e.jsx(G,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:89",open:w,onOpenChange:I,children:e.jsxs(J,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:90",className:"sm:max-w-md",children:[e.jsxs(K,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:91",children:[e.jsxs(Z,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:92",className:"flex items-center gap-2.5",children:[e.jsx("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:93",className:"flex size-8 items-center justify-center rounded-lg bg-[hsl(var(--color-bitcoin))]/10",children:e.jsx(X,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:94",className:"size-4 text-[hsl(var(--color-bitcoin))]"})}),"Pay with Cryptocurrency"]}),e.jsx(ee,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:98",children:x<10?`Pay ${W(x)} ${s} — Select a low-fee cryptocurrency for best results`:`Pay ${W(x)} ${s} using your preferred cryptocurrency`})]}),e.jsx(te,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:105",spacing:"relaxed",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:229",className:"rounded-lg bg-green-500/10 border border-green-500/20 p-4 space-y-3",children:[e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:230",className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx(le,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:231",className:"h-5 w-5"}),e.jsx("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:232",className:"font-medium",children:"Payment Link Created!"})]}),e.jsx("p",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:234",className:"text-sm text-muted-foreground",children:"Click the button below to choose your preferred cryptocurrency and complete your payment on the NOWPayments secure checkout page."})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:242",className:"flex flex-col gap-2",children:[e.jsxs(o,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:243",variant:"crypto",size:"lg",onClick:V,className:"w-full",children:[e.jsx(Me,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:249",className:"size-4"}),"Choose Crypto & Pay"]}),e.jsx(o,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:252",variant:"outline",onClick:n,className:"w-full",children:h?e.jsxs(e.Fragment,{children:[e.jsx(le,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:259",className:"size-4"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:264",className:"size-4"}),"Copy Payment Link"]})})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:272",className:"text-xs text-muted-foreground text-center space-y-1",children:[e.jsx("p",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:273",children:"Payment is processed by NOWPayments"}),e.jsx("p",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:274",children:"You'll be redirected back after payment"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:109",className:"rounded-lg bg-[hsl(var(--color-bitcoin))]/5 border border-[hsl(var(--color-bitcoin))]/20 p-4 space-y-3",children:[e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:110",className:"flex items-center gap-2 text-[hsl(var(--color-bitcoin))]",children:[e.jsx(Fe,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:111",className:"h-5 w-5"}),e.jsx("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:112",className:"font-medium",children:"300+ Cryptocurrencies Supported"})]}),e.jsx("p",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:116",className:"text-sm text-muted-foreground",children:"Click the button below to create a payment link. You'll be able to choose from Bitcoin, Ethereum, USDT, USDC, and 300+ other cryptocurrencies on the secure checkout page."}),e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:121",className:"flex flex-wrap gap-2 pt-1",children:[e.jsxs("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:122",className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-background text-xs font-medium",children:[e.jsx("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:123",className:"text-[hsl(var(--color-bitcoin))]",children:"₿"})," ","BTC"]}),e.jsxs("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:126",className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-background text-xs font-medium",children:[e.jsx("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:127",className:"text-[hsl(var(--color-ethereum))]",children:"Ξ"})," ","ETH"]}),e.jsxs("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:130",className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-background text-xs font-medium",children:[e.jsx("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:131",className:"text-[hsl(var(--color-usdt))]",children:"₮"})," ","USDT"]}),e.jsxs("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:134",className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-background text-xs font-medium",children:[e.jsx("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:135",className:"text-[hsl(var(--color-usdc))]",children:"$"})," ","USDC"]}),e.jsx("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:138",className:"inline-flex items-center gap-1 px-2 py-1 rounded-full bg-background text-xs font-medium text-muted-foreground",children:"+300 more"})]})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:145",className:"rounded-lg border p-4 space-y-1",children:[e.jsx("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:146",className:"text-sm text-muted-foreground",children:"Amount to Pay"}),e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:149",className:"text-2xl font-bold",children:[W(x)," ",s]})]}),x<10&&e.jsx("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:156",className:"rounded-lg border border-amber-200 bg-amber-50 dark:bg-amber-950/30 dark:border-amber-800 p-4",children:e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:157",className:"flex items-start gap-3",children:[e.jsx(Te,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:158",className:"h-5 w-5 text-amber-600 dark:text-amber-500 shrink-0 mt-0.5"}),e.jsxs("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:159",className:"flex-1",children:[e.jsx("h4",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:160",className:"text-sm font-semibold text-amber-900 dark:text-amber-100 mb-2",children:"Small Amount Notice"}),e.jsx("p",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:163",className:"text-xs text-amber-800 dark:text-amber-200 mb-3 leading-relaxed",children:"Cryptocurrency payments include network fees that vary by currency. For amounts under $10, we recommend:"}),e.jsxs("ul",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:167",className:"text-xs text-amber-700 dark:text-amber-300 space-y-1.5",children:[e.jsxs("li",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:168",className:"flex items-center gap-2",children:[e.jsx("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:169",className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),e.jsxs("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:170",children:[e.jsx("strong",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:171",className:"font-semibold",children:"Litecoin (LTC)"})," ","— Fast, low fees"]})]}),e.jsxs("li",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:177",className:"flex items-center gap-2",children:[e.jsx("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:178",className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),e.jsxs("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:179",children:[e.jsx("strong",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:180",className:"font-semibold",children:"Stellar (XLM)"})," ","— Near-instant, minimal fees"]})]}),e.jsxs("li",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:186",className:"flex items-center gap-2",children:[e.jsx("div",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:187",className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),e.jsxs("span",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:188",children:[e.jsx("strong",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:189",className:"font-semibold",children:"USDT on Tron"})," ","— Stablecoin, low fees"]})]})]}),e.jsx("p",{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:196",className:"text-xs text-amber-700 dark:text-amber-300 mt-3",children:"You'll select your currency on the NOWPayments checkout page."})]})]})}),e.jsx(o,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:206",variant:"crypto",size:"lg",className:"w-full",onClick:D,disabled:v.isPending,children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(he,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:215",className:"size-4 animate-spin"}),"Creating Payment Link..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:220",className:"size-4"}),"Create Crypto Payment"]})})]})}),e.jsx(ae,{"data-loc":"client/src/components/payments/CryptoPaymentDialog.tsx:280",onClose:()=>I(!1),cancelText:d?"Close":"Cancel"})]})})}const Xe=[{value:"bank_transfer",label:"Bank Transfer"},{value:"check",label:"Check"},{value:"cash",label:"Cash"},{value:"crypto",label:"Cryptocurrency"},{value:"manual",label:"Other"}];function Ge({open:w,onOpenChange:I,invoiceId:l,invoiceNumber:x,total:s,currency:r,onSuccess:d}){const[m,h]=g.useState(""),[u,v]=g.useState("bank_transfer"),[D,n]=g.useState(q(new Date,"yyyy-MM-dd")),[V,p]=g.useState(""),[M,C]=g.useState(""),[k,S]=g.useState(""),j=y.useUtils(),{data:i,isLoading:a}=y.payments.getSummary.useQuery({invoiceId:l},{enabled:w}),B=y.payments.recordPartial.useMutation({onMutate:async t=>{await j.payments.getSummary.cancel({invoiceId:l});const b=j.payments.getSummary.getData({invoiceId:l});if(b){const U=parseFloat(t.amount),ne=b.totalPaid+U,ce=b.total-ne;j.payments.getSummary.setData({invoiceId:l},{...b,totalPaid:ne,remaining:ce,isFullyPaid:ce<=0,payments:[{id:-Date.now(),invoiceId:l,userId:0,amount:t.amount,currency:r,paymentMethod:t.paymentMethod,stripePaymentIntentId:null,cryptoCurrency:t.cryptoCurrency||null,cryptoTxHash:t.cryptoTxHash||null,paymentDate:t.paymentDate,notes:t.notes||null,status:"completed",createdAt:new Date,updatedAt:new Date},...b.payments]})}return f(),{previousSummary:b}},onSuccess:t=>{c.success(`Payment of ${r} ${m} recorded successfully`),t.remaining<=0&&c.success("Invoice is now fully paid!"),d()},onError:(t,b,U)=>{U?.previousSummary&&j.payments.getSummary.setData({invoiceId:l},U.previousSummary),c.error(t.message||"Failed to record payment")},onSettled:()=>{j.payments.getSummary.invalidate({invoiceId:l}),j.payments.getByInvoice.invalidate({invoiceId:l}),j.invoices.list.invalidate(),j.invoices.get.invalidate({id:l})}}),f=()=>{h(""),v("bank_transfer"),n(q(new Date,"yyyy-MM-dd")),p(""),C(""),S(""),I(!1)},F=()=>{if(!m||parseFloat(m)<=0){c.error("Please enter a valid amount");return}const t=parseFloat(m);if(i&&t>i.remaining){c.error(`Amount cannot exceed remaining balance of ${r} ${i.remaining.toFixed(2)}`);return}B.mutate({invoiceId:l,amount:m,paymentMethod:u,paymentDate:new Date(D),notes:V||void 0,cryptoCurrency:u==="crypto"?M:void 0,cryptoTxHash:u==="crypto"?k:void 0})},_=i?i.totalPaid/i.total*100:0;return e.jsx(G,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:192",open:w,onOpenChange:f,children:e.jsxs(J,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:193",className:"sm:max-w-[500px]",children:[e.jsxs(K,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:194",children:[e.jsx(Z,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:195",children:e.jsx(ve,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:196",icon:Y,title:"Record Payment",variant:"success",size:"sm"})}),e.jsxs(ee,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:203",children:["Record a payment for invoice ",x]})]}),e.jsxs(te,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:208",spacing:"relaxed",children:[a?e.jsx("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:211",className:"flex items-center justify-center py-4",children:e.jsx(he,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:212",className:"h-6 w-6 animate-spin text-muted-foreground"})}):i?e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:215",className:"space-y-3 p-4 bg-secondary/50 rounded-lg border border-border",children:[e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:216",className:"flex justify-between text-sm",children:[e.jsx("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:217",className:"text-muted-foreground",children:"Invoice Total"}),e.jsxs("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:218",className:"font-medium",children:[r," ",i.total.toFixed(2)]})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:222",className:"flex justify-between text-sm",children:[e.jsx("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:223",className:"text-muted-foreground",children:"Already Paid"}),e.jsxs("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:224",className:"font-medium text-green-500",children:[r," ",i.totalPaid.toFixed(2)]})]}),e.jsx(Qe,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:228",value:_,className:"h-2"}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:229",className:"flex justify-between text-sm",children:[e.jsx("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:230",className:"text-muted-foreground",children:"Remaining"}),e.jsxs("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:231",className:"font-bold",children:[r," ",i.remaining.toFixed(2)]})]}),i.isFullyPaid&&e.jsxs(_e,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:237",className:"mt-2 bg-green-500/10 border-green-500/20",children:[e.jsx(Le,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:238",className:"h-4 w-4 text-green-500"}),e.jsx(We,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:239",className:"text-green-600 dark:text-green-400",children:"This invoice is fully paid"})]})]}):null,i&&!i.isFullyPaid&&e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:249",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:251",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:252",htmlFor:"amount",className:"text-sm font-medium",children:"Payment Amount"}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:255",className:"relative",children:[e.jsx(se,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:256",className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(T,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:257",id:"amount",type:"number",step:"0.01",min:"0.01",max:i.remaining,placeholder:"0.00",value:m,onChange:t=>h(t.target.value),className:"pl-9"})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:269",className:"flex gap-2",children:[e.jsx(o,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:270",type:"button",variant:"soft",size:"sm",onClick:()=>h((i.remaining/2).toFixed(2)),children:"50%"}),e.jsx(o,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:280",type:"button",variant:"soft",size:"sm",onClick:()=>h(i.remaining.toFixed(2)),children:"Full Amount"})]})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:292",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:293",htmlFor:"paymentMethod",className:"text-sm font-medium",children:"Payment Method"}),e.jsxs(pe,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:296",value:u,onValueChange:v,children:[e.jsx(xe,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:297",className:"w-full",children:e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:298",className:"flex items-center gap-2",children:[e.jsx(Y,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:299",className:"size-4 text-muted-foreground"}),e.jsx(ye,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:300",placeholder:"Select payment method"})]})}),e.jsx(ge,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:303",children:Xe.map(t=>e.jsx(O,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:305",value:t.value,children:t.label},t.value))})]})]}),u==="crypto"&&e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:315",className:"space-y-4 p-3 border border-[hsl(var(--color-bitcoin))]/30 bg-[hsl(var(--color-bitcoin))]/5 rounded-lg",children:[e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:316",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:317",htmlFor:"cryptoCurrency",className:"text-sm font-medium",children:"Cryptocurrency"}),e.jsx(T,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:323",id:"cryptoCurrency",placeholder:"e.g., BTC, ETH, USDT",value:M,onChange:t=>C(t.target.value)})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:330",className:"space-y-2",children:[e.jsxs(N,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:331",htmlFor:"cryptoTxHash",className:"text-sm font-medium",children:["Transaction Hash"," ",e.jsx("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:336",className:"text-muted-foreground font-normal",children:"(optional)"})]}),e.jsx(T,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:340",id:"cryptoTxHash",placeholder:"0x...",value:k,onChange:t=>S(t.target.value)})]})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:351",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:352",htmlFor:"paymentDate",className:"text-sm font-medium",children:"Payment Date"}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:355",className:"relative",children:[e.jsx(ze,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:356",className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(T,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:357",id:"paymentDate",type:"date",value:D,onChange:t=>n(t.target.value),className:"pl-9"})]})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:368",className:"space-y-2",children:[e.jsxs(N,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:369",htmlFor:"notes",className:"text-sm font-medium",children:["Notes"," ",e.jsx("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:371",className:"text-muted-foreground font-normal",children:"(optional)"})]}),e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:375",className:"relative",children:[e.jsx(Ee,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:376",className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(ue,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:377",id:"notes",placeholder:"Add any notes about this payment...",value:V,onChange:t=>p(t.target.value),rows:2,className:"pl-9 resize-none"})]})]})]}),i&&i.payments.length>0&&e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:392",className:"space-y-2",children:[e.jsx("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:393",className:"h-px bg-border"}),e.jsx(N,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:394",className:"text-sm font-medium",children:"Payment History"}),e.jsx("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:395",className:"max-h-32 overflow-y-auto space-y-2",children:i.payments.map(t=>e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:397",className:"flex items-center justify-between p-2 bg-secondary/30 rounded-lg text-sm",children:[e.jsxs("div",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:401",className:"flex items-center gap-2",children:[e.jsx(Y,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:402",className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:403",children:q(new Date(t.paymentDate),"MMM d, yyyy")}),e.jsx("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:406",className:"text-muted-foreground",children:t.paymentMethod.replace("_"," ")})]}),e.jsxs("span",{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:410",className:"font-medium text-green-500",children:["+",r," ",Number(t.amount).toFixed(2)]})]},t.id))})]})]}),i&&!i.isFullyPaid&&e.jsx(ae,{"data-loc":"client/src/components/payments/PartialPaymentDialog.tsx:421",onClose:f,onSubmit:F,submitText:"Record Payment",cancelText:"Cancel",isLoading:B.isPending,disabled:!m||parseFloat(m)<=0})]})})}function vt(){const{loading:w,isAuthenticated:I}=je(),[,l]=Pe(),x=we(),s=parseInt(x.id||"0"),[r,d]=g.useState(!1),[m,h]=g.useState(!1),[u,v]=g.useState(!1),{data:D,isLoading:n,error:V}=y.invoices.get.useQuery({id:s},{enabled:I&&s>0}),p=y.useUtils(),M=y.invoices.delete.useMutation({onSuccess:()=>{c.success("Invoice deleted successfully"),l("/invoices")},onError:t=>{c.error(t.message||"Failed to delete invoice")}}),C=y.invoices.generatePDF.useMutation({onSuccess:t=>{window.open(t.url,"_blank"),c.success("PDF generated successfully")},onError:t=>{c.error(t.message||"Failed to generate PDF")}}),k=y.invoices.sendEmail.useMutation({onSuccess:()=>{c.success("Invoice sent successfully"),ie.invoiceSent(),p.invoices.get.invalidate({id:s})},onError:t=>{c.error(t.message||"Failed to send invoice")}}),S=y.reminders.sendManual.useMutation({onSuccess:()=>{c.success("Payment reminder sent successfully"),p.invoices.get.invalidate({id:s})},onError:t=>{c.error(t.message||"Failed to send reminder")}}),j=y.invoices.createPaymentLink.useMutation({onSuccess:t=>{c.success("Payment link created"),p.invoices.get.invalidate({id:s}),navigator.clipboard.writeText(t.url),c.success("Payment link copied to clipboard")},onError:t=>{c.error(t.message||"Failed to create payment link")}}),i=y.invoices.update.useMutation({onSuccess:()=>{c.success("Invoice marked as paid"),ie.paymentReceived(),p.invoices.get.invalidate({id:s}),p.invoices.list.invalidate()},onError:t=>{c.error(t.message||"Failed to update invoice")}});if(w||n)return e.jsx(Ye,{"data-loc":"client/src/pages/ViewInvoice.tsx:150"});if(!I)return window.location.href=fe(),null;if(V||!D)return e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:160",className:"min-h-screen bg-background",children:[e.jsx("nav",{"data-loc":"client/src/pages/ViewInvoice.tsx:161",className:"border-b bg-card/50 backdrop-blur-sm",children:e.jsx("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:162",className:"container mx-auto px-4 py-4 flex items-center justify-between",children:e.jsx(Q,{"data-loc":"client/src/pages/ViewInvoice.tsx:163",href:"/dashboard",className:"flex items-center gap-2",children:e.jsx("img",{"data-loc":"client/src/pages/ViewInvoice.tsx:164",src:"/SleekInvoices-Wide.svg",alt:"SleekInvoices",className:"h-6"})})})}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:172",className:"container mx-auto px-4 md:px-6 py-12 md:py-16 text-center",children:[e.jsx("h1",{"data-loc":"client/src/pages/ViewInvoice.tsx:173",className:"text-2xl font-bold text-foreground mb-4",children:"Invoice Not Found"}),e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:176",className:"text-muted-foreground mb-8",children:"The invoice you're looking for doesn't exist or you don't have permission to view it."}),e.jsx(Q,{"data-loc":"client/src/pages/ViewInvoice.tsx:180",href:"/invoices",children:e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:181",children:[e.jsx(re,{"data-loc":"client/src/pages/ViewInvoice.tsx:182",className:"h-4 w-4 mr-2"}),"Back to Invoices"]})})]})]});const{invoice:a,lineItems:B,client:f,viewCount:F}=D,_=()=>{i.mutate({id:s,status:"paid"})};return e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:201",className:"min-h-screen bg-background",children:[e.jsx(Se,{"data-loc":"client/src/pages/ViewInvoice.tsx:202"}),e.jsx("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:205",className:"container mx-auto px-4 py-8",children:e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:206",className:"max-w-4xl mx-auto",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:208",className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:209",className:"flex items-center gap-4",children:[e.jsx(Q,{"data-loc":"client/src/pages/ViewInvoice.tsx:210",href:"/invoices",children:e.jsx("a",{"data-loc":"client/src/pages/ViewInvoice.tsx:211",children:e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:212",variant:"ghost",size:"sm",children:[e.jsx(re,{"data-loc":"client/src/pages/ViewInvoice.tsx:213",className:"h-4 w-4 mr-2"}),"Back"]})})}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:218",children:[e.jsx("h1",{"data-loc":"client/src/pages/ViewInvoice.tsx:219",className:"text-3xl font-bold text-foreground",children:a.invoiceNumber}),e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:222",className:"text-muted-foreground",children:"Invoice Details"})]})]}),e.jsx(me,{"data-loc":"client/src/pages/ViewInvoice.tsx:225",status:a.status})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:229",className:"flex flex-wrap items-center gap-2 mb-6",children:[e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:230",variant:"outline",size:"sm",onClick:()=>l(`/invoices/${s}/edit`),children:[e.jsx(Oe,{"data-loc":"client/src/pages/ViewInvoice.tsx:235",className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:238",variant:"outline",size:"sm",onClick:()=>C.mutate({id:s}),disabled:C.isPending,"aria-busy":C.isPending,children:[e.jsx(Be,{"data-loc":"client/src/pages/ViewInvoice.tsx:245",className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Download PDF"]}),e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:248",variant:"outline",size:"sm",onClick:()=>k.mutate({id:s}),disabled:k.isPending,"aria-busy":k.isPending,children:[e.jsx(de,{"data-loc":"client/src/pages/ViewInvoice.tsx:255",className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Send Email"]}),a.status==="overdue"&&e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:259",variant:"outline",size:"sm",onClick:()=>S.mutate({invoiceId:a.id}),disabled:S.isPending,"aria-busy":S.isPending,className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50",children:[e.jsx(de,{"data-loc":"client/src/pages/ViewInvoice.tsx:267",className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Send Reminder"]}),!a.stripePaymentLinkUrl&&e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:272",variant:"outline",size:"sm",onClick:()=>j.mutate({id:s}),disabled:j.isPending,"aria-busy":j.isPending,children:[e.jsx(Ue,{"data-loc":"client/src/pages/ViewInvoice.tsx:279",className:"h-4 w-4 mr-2","aria-hidden":"true"}),"Create Payment Link"]}),(a.status==="sent"||a.status==="overdue"||a.status==="viewed")&&(()=>{const t=parseFloat(a.total)-parseFloat(a.amountPaid);return e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:290",variant:"outline",size:"sm",onClick:()=>h(!0),className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50 gap-2",children:[e.jsx(X,{"data-loc":"client/src/pages/ViewInvoice.tsx:296",className:"h-4 w-4"}),"Pay with Crypto",t<10&&e.jsx(Ne,{"data-loc":"client/src/pages/ViewInvoice.tsx:299",variant:"outline",className:"ml-1 text-[10px] border-amber-500 text-amber-600 dark:text-amber-500",children:"$10+ recommended"})]})})(),(a.status==="sent"||a.status==="overdue"||a.status==="viewed")&&e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:312",variant:"outline",size:"sm",onClick:()=>v(!0),className:"text-green-600 hover:text-green-700 hover:bg-green-50",children:[e.jsx(se,{"data-loc":"client/src/pages/ViewInvoice.tsx:318",className:"h-4 w-4 mr-2"}),"Record Payment"]}),(a.status==="sent"||a.status==="overdue")&&e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:323",variant:"outline",size:"sm",onClick:_,disabled:i.isPending,children:[e.jsx(He,{"data-loc":"client/src/pages/ViewInvoice.tsx:329",className:"h-4 w-4 mr-2"}),"Mark as Paid"]}),e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:333",variant:"outline",size:"sm",onClick:()=>d(!0),className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:[e.jsx(Re,{"data-loc":"client/src/pages/ViewInvoice.tsx:339",className:"h-4 w-4 mr-2"}),"Delete"]})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:345",className:"space-y-6",children:[e.jsxs(A,{"data-loc":"client/src/pages/ViewInvoice.tsx:347",children:[e.jsx(L,{"data-loc":"client/src/pages/ViewInvoice.tsx:348",children:e.jsx(z,{"data-loc":"client/src/pages/ViewInvoice.tsx:349",children:"Invoice Information"})}),e.jsx(E,{"data-loc":"client/src/pages/ViewInvoice.tsx:351",children:e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:352",className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:353",children:[e.jsx("h3",{"data-loc":"client/src/pages/ViewInvoice.tsx:354",className:"text-sm font-medium text-muted-foreground mb-2",children:"Bill To"}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:357",className:"space-y-1",children:[e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:358",className:"font-semibold",children:f?.name||"Unknown Client"}),f?.email&&e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:362",className:"text-sm",children:f.email}),f?.phone&&e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:365",className:"text-sm",children:f.phone}),f?.address&&e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:368",className:"text-sm whitespace-pre-line",children:f.address})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:374",className:"space-y-3",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:375",children:[e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:376",className:"text-sm text-muted-foreground",children:["Issue Date:"," "]}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:379",className:"font-medium",children:e.jsx($,{"data-loc":"client/src/pages/ViewInvoice.tsx:380",date:a.issueDate,format:"long"})})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:383",children:[e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:384",className:"text-sm text-muted-foreground",children:["Due Date:"," "]}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:387",className:"font-medium",children:e.jsx($,{"data-loc":"client/src/pages/ViewInvoice.tsx:388",date:a.dueDate,format:"long"})})]}),a.paidAt&&e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:392",children:[e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:393",className:"text-sm text-muted-foreground",children:["Paid At:"," "]}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:396",className:"font-medium",children:e.jsx($,{"data-loc":"client/src/pages/ViewInvoice.tsx:397",date:a.paidAt,format:"long"})})]}),F!==void 0&&F>0&&e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:402",className:"flex items-center gap-2",children:[e.jsx($e,{"data-loc":"client/src/pages/ViewInvoice.tsx:403",className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:404",className:"text-sm text-muted-foreground",children:["Viewed ",F," time",F!==1?"s":""]}),a.firstViewedAt&&e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:408",className:"text-xs text-muted-foreground",children:["(first:"," ",e.jsx($,{"data-loc":"client/src/pages/ViewInvoice.tsx:410",date:a.firstViewedAt,format:"long"}),")"]})]})]})]})})]}),e.jsxs(A,{"data-loc":"client/src/pages/ViewInvoice.tsx:425",children:[e.jsx(L,{"data-loc":"client/src/pages/ViewInvoice.tsx:426",children:e.jsx(z,{"data-loc":"client/src/pages/ViewInvoice.tsx:427",children:"Line Items"})}),e.jsx(E,{"data-loc":"client/src/pages/ViewInvoice.tsx:429",children:e.jsxs(Ve,{"data-loc":"client/src/pages/ViewInvoice.tsx:430",children:[e.jsx(be,{"data-loc":"client/src/pages/ViewInvoice.tsx:431",children:e.jsxs(oe,{"data-loc":"client/src/pages/ViewInvoice.tsx:432",children:[e.jsx(H,{"data-loc":"client/src/pages/ViewInvoice.tsx:433",scope:"col",children:"Description"}),e.jsx(H,{"data-loc":"client/src/pages/ViewInvoice.tsx:434",className:"text-right",scope:"col",children:"Quantity"}),e.jsx(H,{"data-loc":"client/src/pages/ViewInvoice.tsx:437",className:"text-right",scope:"col",children:"Rate"}),e.jsx(H,{"data-loc":"client/src/pages/ViewInvoice.tsx:440",className:"text-right",scope:"col",children:"Amount"})]})}),e.jsx(Ce,{"data-loc":"client/src/pages/ViewInvoice.tsx:445",children:B?.map(t=>e.jsxs(oe,{"data-loc":"client/src/pages/ViewInvoice.tsx:447",children:[e.jsx(R,{"data-loc":"client/src/pages/ViewInvoice.tsx:448",children:t.description}),e.jsx(R,{"data-loc":"client/src/pages/ViewInvoice.tsx:449",className:"text-right",children:t.quantity}),e.jsx(R,{"data-loc":"client/src/pages/ViewInvoice.tsx:452",className:"text-right",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:453",amount:t.rate})}),e.jsx(R,{"data-loc":"client/src/pages/ViewInvoice.tsx:455",className:"text-right font-medium",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:456",amount:t.amount})})]},t.id))})]})})]}),e.jsxs(A,{"data-loc":"client/src/pages/ViewInvoice.tsx:466",children:[e.jsx(L,{"data-loc":"client/src/pages/ViewInvoice.tsx:467",children:e.jsx(z,{"data-loc":"client/src/pages/ViewInvoice.tsx:468",children:"Totals"})}),e.jsx(E,{"data-loc":"client/src/pages/ViewInvoice.tsx:470",children:e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:471",className:"space-y-3",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:472",className:"flex items-center justify-between",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:473",className:"text-muted-foreground",children:"Subtotal"}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:474",className:"font-medium",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:475",amount:a.subtotal})})]}),parseFloat(a.discountAmount)>0&&e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:479",className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:480",className:"text-muted-foreground",children:["Discount",a.discountType==="percentage"?` (${a.discountValue}%)`:""]}),e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:486",className:"text-destructive",children:["-",e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:487",amount:a.discountAmount})]})]}),parseFloat(a.taxAmount)>0&&e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:492",className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:493",className:"text-muted-foreground",children:["Tax (",a.taxRate,"%)"]}),e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:496",children:["+",e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:497",amount:a.taxAmount})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:501",className:"flex items-center justify-between pt-3 border-t-2 border-primary/20",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:502",className:"text-lg font-bold",children:"Total"}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:503",className:"text-2xl font-bold text-primary",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:504",amount:a.total})})]}),parseFloat(a.amountPaid)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:509",className:"flex items-center justify-between text-sm",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:510",className:"text-muted-foreground",children:"Amount Paid"}),e.jsxs("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:513",className:"text-green-600",children:["-",e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:514",amount:a.amountPaid})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:517",className:"flex items-center justify-between pt-2 border-t",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:518",className:"font-semibold",children:"Balance Due"}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:519",className:"font-bold",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:520",amount:parseFloat(a.total)-parseFloat(a.amountPaid)})})]})]})]})})]}),e.jsx(Je,{"data-loc":"client/src/pages/ViewInvoice.tsx:535",invoiceId:s,invoiceTotal:parseFloat(a.total)}),(a.notes||a.paymentTerms||a.stripePaymentLinkUrl)&&e.jsxs(A,{"data-loc":"client/src/pages/ViewInvoice.tsx:544",children:[e.jsx(L,{"data-loc":"client/src/pages/ViewInvoice.tsx:545",children:e.jsx(z,{"data-loc":"client/src/pages/ViewInvoice.tsx:546",children:"Additional Information"})}),e.jsxs(E,{"data-loc":"client/src/pages/ViewInvoice.tsx:548",className:"space-y-4",children:[a.notes&&e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:550",children:[e.jsx("h3",{"data-loc":"client/src/pages/ViewInvoice.tsx:551",className:"text-sm font-medium text-muted-foreground mb-2",children:"Notes"}),e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:554",className:"text-sm whitespace-pre-line",children:a.notes})]}),a.paymentTerms&&e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:560",children:[e.jsx("h3",{"data-loc":"client/src/pages/ViewInvoice.tsx:561",className:"text-sm font-medium text-muted-foreground mb-2",children:"Payment Terms"}),e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:564",className:"text-sm",children:a.paymentTerms})]}),a.stripePaymentLinkUrl&&e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:568",children:[e.jsx("h3",{"data-loc":"client/src/pages/ViewInvoice.tsx:569",className:"text-sm font-medium text-muted-foreground mb-2",children:"Online Payment"}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:572",className:"space-y-3",children:[e.jsx("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:573",className:"flex items-center gap-2",children:e.jsxs(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:574",className:"flex-1",onClick:()=>{window.open(a.stripePaymentLinkUrl,"_blank"),c.info("Opening payment page in new tab")},children:[e.jsx("svg",{"data-loc":"client/src/pages/ViewInvoice.tsx:584",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{"data-loc":"client/src/pages/ViewInvoice.tsx:590",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"Pay Now with Stripe"]})}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:600",className:"flex items-center gap-2",children:[e.jsx("code",{"data-loc":"client/src/pages/ViewInvoice.tsx:601",className:"flex-1 p-2 bg-muted rounded text-xs break-all",children:a.stripePaymentLinkUrl}),e.jsx(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:604",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(a.stripePaymentLinkUrl),c.success("Payment link copied to clipboard")},children:"Copy"})]}),e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:617",className:"text-xs text-muted-foreground",children:"Secure payment powered by Stripe. Share this link with your client to accept online payments."})]})]})]})]})]})]})}),e.jsx(ke,{"data-loc":"client/src/pages/ViewInvoice.tsx:632",open:r,onOpenChange:d,onConfirm:()=>M.mutate({id:s}),title:"Delete Invoice",description:`Are you sure you want to delete invoice ${a.invoiceNumber}? This action cannot be undone.`,isLoading:M.isPending}),e.jsx(qe,{"data-loc":"client/src/pages/ViewInvoice.tsx:642",open:m,onOpenChange:h,invoiceId:s,amount:parseFloat(a?.total||"0")-parseFloat(a?.amountPaid||"0"),currency:a?.currency||"USD",onPaymentCreated:()=>p.invoices.get.invalidate({id:s})}),e.jsx(Ge,{"data-loc":"client/src/pages/ViewInvoice.tsx:657",open:u,onOpenChange:v,invoiceId:s,invoiceNumber:a.invoiceNumber,total:parseFloat(a.total),currency:a.currency,onSuccess:()=>{p.invoices.get.invalidate({id:s}),p.invoices.list.invalidate()}})]})}function Je({invoiceId:w,invoiceTotal:I}){const[l,x]=g.useState(!1),[s,r]=g.useState({amount:"",currency:"USD",paymentMethod:"manual",paymentDate:new Date().toISOString().split("T")[0],notes:""}),{data:d,refetch:m}=y.payments.getByInvoice.useQuery({invoiceId:w}),h=y.payments.create.useMutation({onSuccess:()=>{c.success("Payment recorded successfully"),x(!1),m(),r({amount:"",currency:"USD",paymentMethod:"manual",paymentDate:new Date().toISOString().split("T")[0],notes:""})},onError:n=>{c.error(`Failed to record payment: ${n.message}`)}}),u=()=>{if(!s.amount){c.error("Please enter an amount");return}h.mutate({invoiceId:w,amount:s.amount,currency:s.currency,paymentMethod:s.paymentMethod,paymentDate:new Date(s.paymentDate),notes:s.notes||void 0})},v=d?.reduce((n,V)=>n+parseFloat(V.amount),0)||0,D=I-v;return e.jsxs(e.Fragment,{children:[e.jsxs(A,{"data-loc":"client/src/pages/ViewInvoice.tsx:733",children:[e.jsx(L,{"data-loc":"client/src/pages/ViewInvoice.tsx:734",children:e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:735",className:"flex items-center justify-between",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:736",children:[e.jsx(z,{"data-loc":"client/src/pages/ViewInvoice.tsx:737",children:"Payment History"}),e.jsxs(Ie,{"data-loc":"client/src/pages/ViewInvoice.tsx:738",children:[d?.length||0," payment(s) recorded"]})]}),e.jsx(o,{"data-loc":"client/src/pages/ViewInvoice.tsx:742",size:"sm",onClick:()=>x(!0),children:"Record Payment"})]})}),e.jsxs(E,{"data-loc":"client/src/pages/ViewInvoice.tsx:747",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:749",className:"mb-4 p-4 bg-muted rounded-lg space-y-2",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:750",className:"flex justify-between text-sm",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:751",className:"text-muted-foreground",children:"Invoice Total:"}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:752",className:"font-semibold",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:753",amount:I})})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:756",className:"flex justify-between text-sm",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:757",className:"text-muted-foreground",children:"Total Paid:"}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:758",className:"font-semibold text-green-600",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:759",amount:v})})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:762",className:"flex justify-between text-sm pt-2 border-t",children:[e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:763",className:"font-medium",children:"Balance Due:"}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:764",className:"font-bold",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:765",amount:D})})]})]}),!d||d.length===0?e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:772",className:"text-center text-muted-foreground py-4",children:"No payments recorded yet"}):e.jsx("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:776",className:"space-y-3",children:d.map(n=>e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:778",className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:782",children:[e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:783",className:"font-medium",children:e.jsx(P,{"data-loc":"client/src/pages/ViewInvoice.tsx:784",amount:n.amount,bold:!0})}),e.jsxs("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:786",className:"text-sm text-muted-foreground",children:[De(n.paymentDate)," •"," ",n.paymentMethod.replace("_"," ")]}),n.notes&&e.jsx("p",{"data-loc":"client/src/pages/ViewInvoice.tsx:791",className:"text-xs text-muted-foreground mt-1",children:n.notes})]}),e.jsx(me,{"data-loc":"client/src/pages/ViewInvoice.tsx:796",status:n.status})]},n.id))})]})]}),e.jsx(G,{"data-loc":"client/src/pages/ViewInvoice.tsx:805",open:l,onOpenChange:x,children:e.jsxs(J,{"data-loc":"client/src/pages/ViewInvoice.tsx:806",className:"sm:max-w-[500px]",children:[e.jsxs(K,{"data-loc":"client/src/pages/ViewInvoice.tsx:807",className:"pb-4",children:[e.jsxs(Z,{"data-loc":"client/src/pages/ViewInvoice.tsx:808",className:"flex items-center gap-3",children:[e.jsx("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:809",className:"p-3 rounded-xl bg-primary/10",children:e.jsx(se,{"data-loc":"client/src/pages/ViewInvoice.tsx:810",className:"h-5 w-5 text-primary"})}),e.jsx("span",{"data-loc":"client/src/pages/ViewInvoice.tsx:812",className:"text-xl",children:"Record Payment"})]}),e.jsx(ee,{"data-loc":"client/src/pages/ViewInvoice.tsx:814",className:"text-base",children:"Record a payment for this invoice"})]}),e.jsx(te,{"data-loc":"client/src/pages/ViewInvoice.tsx:818",spacing:"default",children:e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:819",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:820",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/pages/ViewInvoice.tsx:821",htmlFor:"amount",children:"Amount *"}),e.jsx(T,{"data-loc":"client/src/pages/ViewInvoice.tsx:822",id:"amount",type:"number",step:"0.01",placeholder:"0.00",value:s.amount,onChange:n=>r({...s,amount:n.target.value})})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:834",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/pages/ViewInvoice.tsx:835",htmlFor:"paymentMethod",children:"Payment Method"}),e.jsxs(pe,{"data-loc":"client/src/pages/ViewInvoice.tsx:836",value:s.paymentMethod,onValueChange:n=>r({...s,paymentMethod:n}),children:[e.jsx(xe,{"data-loc":"client/src/pages/ViewInvoice.tsx:842",children:e.jsx(ye,{"data-loc":"client/src/pages/ViewInvoice.tsx:843"})}),e.jsxs(ge,{"data-loc":"client/src/pages/ViewInvoice.tsx:845",children:[e.jsx(O,{"data-loc":"client/src/pages/ViewInvoice.tsx:846",value:"manual",children:"Manual"}),e.jsx(O,{"data-loc":"client/src/pages/ViewInvoice.tsx:847",value:"bank_transfer",children:"Bank Transfer"}),e.jsx(O,{"data-loc":"client/src/pages/ViewInvoice.tsx:848",value:"check",children:"Check"}),e.jsx(O,{"data-loc":"client/src/pages/ViewInvoice.tsx:849",value:"cash",children:"Cash"})]})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:854",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/pages/ViewInvoice.tsx:855",htmlFor:"paymentDate",children:"Payment Date"}),e.jsx(T,{"data-loc":"client/src/pages/ViewInvoice.tsx:856",id:"paymentDate",type:"date",value:s.paymentDate,onChange:n=>r({...s,paymentDate:n.target.value})})]}),e.jsxs("div",{"data-loc":"client/src/pages/ViewInvoice.tsx:866",className:"space-y-2",children:[e.jsx(N,{"data-loc":"client/src/pages/ViewInvoice.tsx:867",htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(ue,{"data-loc":"client/src/pages/ViewInvoice.tsx:868",id:"notes",placeholder:"Add any notes...",value:s.notes,onChange:n=>r({...s,notes:n.target.value})})]})]})}),e.jsx(ae,{"data-loc":"client/src/pages/ViewInvoice.tsx:879",onClose:()=>x(!1),onSubmit:u,submitText:"Record Payment",cancelText:"Cancel",isLoading:h.isPending,disabled:!s.amount})]})})]})}export{vt as default};
