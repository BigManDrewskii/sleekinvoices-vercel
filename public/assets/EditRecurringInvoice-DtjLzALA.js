import{r as i,j as e}from"./vendor-react-BuVtq312.js";import{u as ce,y as ie,t as Y,C as d,z as u,A as g,E,a as x,B as p,I as j,k as y}from"./index-hzFfJlKH.js";import{L as l}from"./label-DJDGx5UM.js";import{T as se}from"./textarea-CA7ezKjn.js";import{S as ne,a as ae,b as re,c as oe,d as C}from"./select-BmfPitD4.js";import{P as b}from"./PageLayout-D7c6YbGr.js";import{C as le,L as de,I as ue}from"./InvoiceFormCalculations-YZzX9-IS.js";import{z as _,a8 as ge}from"./vendor-icons-CPPAmKDz.js";import"./vendor-data-DopHG4T0.js";import"./vendor-radix-DQBG9U-J.js";import"./Navigation-DKoTJDrW.js";import"./UserAvatar-DzPpP9tb.js";import"./ClientDialog-Ch_MRpgo.js";import"./checkbox-Cacebbmr.js";import"./typography-CdqW54LS.js";import"./vendor-date-B2OJh1lx.js";function Te(){const[,v]=ce(),G=ie(),f=parseInt(G.id||"0"),[N,T]=i.useState(),[w,P]=i.useState("monthly"),[q,F]=i.useState(new Date().toISOString().split("T")[0]),[D,L]=i.useState(""),[A,k]=i.useState("INV"),[n,m]=i.useState([{id:crypto.randomUUID(),description:"",quantity:1,rate:0}]),[I,V]=i.useState(0),[h,U]=i.useState("percentage"),[o,B]=i.useState(0),[M,O]=i.useState(""),[z,H]=i.useState("Net 30"),s={startDate:i.useId(),endDate:i.useId(),invoiceNumberPrefix:i.useId(),paymentTerms:i.useId(),notes:i.useId()},{data:r,isLoading:J}=Y.recurringInvoices.get.useQuery({id:f},{enabled:f>0});i.useEffect(()=>{if(r?.recurring){const t=r.recurring;T(t.clientId),P(t.frequency),F(t.startDate?new Date(t.startDate).toISOString().split("T")[0]:""),L(t.endDate?new Date(t.endDate).toISOString().split("T")[0]:""),k(t.invoiceNumberPrefix),V(parseFloat(t.taxRate)||0),U(t.discountType||"percentage"),B(parseFloat(t.discountValue)||0),O(t.notes||""),H(t.paymentTerms||"Net 30")}r?.lineItems&&r.lineItems.length>0&&m(r.lineItems.map(t=>({id:t.id.toString(),description:t.description,quantity:parseFloat(t.quantity)||0,rate:parseFloat(t.rate)||0})))},[r]);const S=Y.recurringInvoices.update.useMutation(),R=i.useMemo(()=>{const t=n.reduce((te,W)=>te+W.quantity*W.rate,0);let c=0;o>0&&(h==="percentage"?c=t*o/100:c=o);const a=t-c,Q=a*I/100,ee=a+Q;return{subtotal:t,discountAmount:c,taxAmount:Q,total:ee}},[n,I,h,o]),K=(t,c)=>{const a=[...n];a[t]=c,m(a)},X=t=>{m(n.filter((c,a)=>a!==t))},Z=()=>{m([...n,{id:crypto.randomUUID(),description:"",quantity:1,rate:0}])},$=async t=>{if(t.preventDefault(),!N){y.error("Please select a client");return}if(n.some(c=>!c.description||c.quantity<=0||c.rate<=0)){y.error("Please fill in all line items");return}try{await S.mutateAsync({id:f,clientId:N,frequency:w,startDate:new Date(q),endDate:D?new Date(D):void 0,invoiceNumberPrefix:A,lineItems:n.map(c=>({description:c.description,quantity:c.quantity,rate:c.rate})),taxRate:I,discountType:h,discountValue:o,notes:M,paymentTerms:z}),y.success("Recurring invoice updated successfully!"),v("/recurring-invoices")}catch(c){y.error("Failed to update recurring invoice"),console.error(c)}};return J?e.jsx(b,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:196",title:"Loading...",children:e.jsx("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:197",className:"flex items-center justify-center py-12",children:e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:198",className:"text-center",children:[e.jsx("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:199",className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:200",className:"text-muted-foreground mt-2",children:"Loading recurring invoice..."})]})})}):r?.recurring?e.jsx(b,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:237",title:"Edit Recurring Invoice",subtitle:"Update your recurring invoice settings",narrow:!0,headerActions:e.jsxs(p,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:242",variant:"ghost",onClick:()=>v("/recurring-invoices"),children:[e.jsx(_,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:246",className:"w-4 h-4 mr-2"}),"Back"]}),children:e.jsxs("form",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:251",onSubmit:$,className:"space-y-6",children:[e.jsxs(d,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:252",children:[e.jsxs(u,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:253",children:[e.jsx(g,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:254",children:"Schedule Settings"}),e.jsx(E,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:255",children:"Configure how often this invoice should be generated and sent"})]}),e.jsxs(x,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:259",className:"space-y-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:260",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:261",className:"space-y-2",children:[e.jsx(l,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:262",htmlFor:s.invoiceNumberPrefix,children:"Invoice Number Prefix"}),e.jsx(j,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:265",id:s.invoiceNumberPrefix,value:A,onChange:t=>k(t.target.value),placeholder:"INV",required:!0})]}),e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:274",className:"space-y-2",children:[e.jsx(l,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:275",htmlFor:"frequency",children:"Frequency"}),e.jsxs(ne,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:276",value:w,onValueChange:t=>P(t),children:[e.jsx(ae,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:282",children:e.jsx(re,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:283",placeholder:"Select frequency"})}),e.jsxs(oe,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:285",children:[e.jsx(C,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:286",value:"weekly",children:"Weekly"}),e.jsx(C,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:287",value:"monthly",children:"Monthly"}),e.jsx(C,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:288",value:"yearly",children:"Yearly"})]})]})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:294",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:295",className:"space-y-2",children:[e.jsx(l,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:296",htmlFor:s.startDate,children:"Start Date"}),e.jsx(j,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:297",id:s.startDate,type:"date",value:q,onChange:t=>F(t.target.value),required:!0})]}),e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:306",className:"space-y-2",children:[e.jsx(l,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:307",htmlFor:s.endDate,children:"End Date (Optional)"}),e.jsx(j,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:308",id:s.endDate,type:"date",value:D,onChange:t=>L(t.target.value)})]})]}),e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:317",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:318",className:"space-y-2",children:[e.jsx(l,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:319",htmlFor:s.paymentTerms,children:"Payment Terms"}),e.jsx(j,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:320",id:s.paymentTerms,value:z,onChange:t=>H(t.target.value),placeholder:"Net 30"})]}),e.jsx(le,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:328",value:N??null,onChange:t=>T(t??void 0)})]})]})]}),e.jsxs(d,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:336",children:[e.jsx(u,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:337",children:e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:338",className:"flex items-center justify-between",children:[e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:339",children:[e.jsx(g,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:340",children:"Line Items"}),e.jsx(E,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:341",children:"Products or services to include on each invoice"})]}),e.jsxs(p,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:345",type:"button",variant:"outline",size:"sm",onClick:Z,children:[e.jsx(ge,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:351",className:"w-4 h-4 mr-2"}),"Add Item"]})]})}),e.jsx(x,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:356",className:"space-y-4",children:e.jsx("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:357",className:"space-y-3",children:n.map((t,c)=>e.jsx(de,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:359",item:t,onChange:a=>K(c,a),onDelete:()=>X(c),canDelete:n.length>1},t.id))})})]}),e.jsxs(d,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:373",children:[e.jsxs(u,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:374",children:[e.jsx(g,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:375",children:"Totals"}),e.jsx(E,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:376",children:"Tax, discounts, and calculations for each invoice"})]}),e.jsx(x,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:380",children:e.jsx(ue,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:381",subtotal:R.subtotal,taxRate:I,onTaxRateChange:V,discountType:h,onDiscountTypeChange:U,discountValue:o,onDiscountValueChange:B,discountAmount:R.discountAmount,taxAmount:R.taxAmount,total:R.total})})]}),e.jsxs(d,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:396",children:[e.jsx(u,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:397",children:e.jsx(g,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:398",children:"Additional Details"})}),e.jsx(x,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:400",className:"space-y-4",children:e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:401",className:"space-y-2",children:[e.jsx(l,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:402",htmlFor:s.notes,children:"Notes"}),e.jsx(se,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:403",id:s.notes,value:M,onChange:t=>O(t.target.value),placeholder:"Additional notes to include on the invoice...",rows:3})]})})]}),e.jsxs("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:414",className:"flex gap-4",children:[e.jsx(p,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:415",type:"submit",disabled:S.isPending,children:S.isPending?"Saving...":"Save Changes"}),e.jsx(p,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:418",type:"button",variant:"outline",onClick:()=>v("/recurring-invoices"),children:"Cancel"})]})]})}):e.jsx(b,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:211",title:"Not Found",children:e.jsx("div",{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:212",className:"flex items-center justify-center py-12",children:e.jsxs(d,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:213",className:"w-full max-w-md",children:[e.jsxs(u,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:214",children:[e.jsx(g,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:215",children:"Recurring Invoice Not Found"}),e.jsx(E,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:216",children:"The recurring invoice you are trying to edit does not exist or has been deleted."})]}),e.jsx(x,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:221",children:e.jsxs(p,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:222",onClick:()=>v("/recurring-invoices"),className:"w-full",children:[e.jsx(_,{"data-loc":"client/src/pages/EditRecurringInvoice.tsx:226",className:"mr-2 h-4 w-4"}),"Back to Recurring Invoices"]})})]})})})}export{Te as default};
